var version=function(e,t){"use strict";class i{constructor(){this.cameras=new Map,this.lights=new Map,this.objects=new Map,this.geometries=new Map,this.materials=new Map,this.helpers=new Map,this.textures=new Map,this.geometriesRefCounter=new Map,this.materialsRefCounter=new Map,this.texturesRefCounter=new Map}addCamera(e){e?.isCamera?this.cameras.set(e.uuid,e):console.error("Editor.Container.addCamera: object not an instance of THREE.Camera.",e)}removeCamera(e){this.cameras.delete(e?.uuid)}addLight(e){e?.isLight?this.lights.set(e.uuid,e):console.error("Editor.Container.addLight: object not an instance of THREE.Light.",e)}removeLight(e){this.lights.delete(e?.uuid)}addObject(e){e?.isObject3D?this.objects.set(e.uuid,e):console.error("Editor.Container.addObject: object not an instance of THREE.Object3D.",e)}removeObject(e){this.objects.delete(e?.uuid)}getObjectByUUID(e){return this.objects.get(e)}addGeometry(e){e?.isBufferGeometry?this.addObjectToRefCounter(e,this.geometriesRefCounter,this.geometries):console.error("Editor.Container.addGeometry: object not an instance of THREE.BufferGeometry.",e)}removeGeometry(e){this.removeObjectToRefCounter(e,this.geometriesRefCounter,this.geometries)}getGeometryByUUID(e){return this.geometries.get(e)}addMaterial(e){if(Array.isArray(e))for(let t=0,i=e.length;t<i;t++){if(!e[t]?.isMaterial){console.error("Editor.Container.addMaterial: object not an instance of THREE.Material in Material Array.",e[t]);break}this.addObjectToRefCounter(e[t],this.materialsRefCounter,this.materials)}else e?.isMaterial?this.addObjectToRefCounter(e,this.materialsRefCounter,this.materials):console.error("Editor.Container.addMaterial: object not an instance of THREE.Material.",e)}removeMaterial(e){if(Array.isArray(e))for(let t=0,i=e.length;t<i;t++)this.removeObjectToRefCounter(e[t],this.materialsRefCounter,this.materials);else this.removeObjectToRefCounter(e,this.materialsRefCounter,this.materials)}getMaterialByUUID(e){return this.materials.get(e)}addTexture(e){e?.isTexture?this.addObjectToRefCounter(e,this.texturesRefCounter,this.textures):console.error("Editor.Container.addTexture: object not an instance of THREE.Texture.",e)}removeTexture(e){this.removeObjectToRefCounter(e,this.texturesRefCounter,this.textures)}getTextureByUUID(e){return this.textures.get(e)}addHelper(e){this.helpers.set(e?.uuid,e)}removeHelper(e){this.helpers.has(e?.uuid)&&this.helpers.delete(e.uuid)}getHelperByUUID(e){return this.helpers.get(e)}addObjectToRefCounter(e,t,i){let n=t.get(e.uuid);void 0===n?(i.set(e.uuid,e),t.set(e.uuid,1)):t.set(e.uuid,n++)}removeObjectToRefCounter(e,t,i){let n=t.get(e.uuid);n--,0===n?(t.delete(e.uuid),i.delete(e.uuid)):t.set(e.uuid,n)}}
/** @license
   * JS Signals <http://millermedeiros.github.com/js-signals/>
   * Released under the MIT license
   * Author: Miller Medeiros
   * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
   */function n(e,t,i,n,s){this._listener=t,this._isOnce=i,this.context=n,this._signal=e,this._priority=s||0}function s(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function o(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){o.prototype.dispatch.apply(e,arguments)}}function r(e){return JSON.stringify(e)}n.prototype={active:!0,params:null,execute:function(e){var t,i;return this.active&&this._listener&&(i=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,i),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},o.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,i,s){var o,r=this._indexOfListener(e,i);if(-1!==r){if((o=this._bindings[r]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else o=new n(this,e,t,i,s),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var i,n=this._bindings.length;n--;)if((i=this._bindings[n])._listener===e&&i.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,i){return s(e,"add"),this._registerListener(e,!1,t,i)},addOnce:function(e,t,i){return s(e,"addOnce"),this._registerListener(e,!0,t,i)},remove:function(e,t){s(e,"remove");var i=this._indexOfListener(e,t);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,i=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=i),n){t=this._bindings.slice(),this._shouldPropagate=!0;do{n--}while(t[n]&&this._shouldPropagate&&!1!==t[n].execute(i))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};class a{constructor(e){this.multipleSelect=!1,this.editor=e,this.signals=e.signals,this.signals.intersectionsDetected.add((e=>{e.length>0?this.multipleSelect?this.select([e[0]]):this.select(e):this.select([])}))}select(e){var t,i;(t=this.editor.selected,i=e,r(t)!==r(i))&&(this.editor.selected=e,1===e.length?this.signals.objectSelected.dispatch(e):this.signals.objectSelected.dispatch([]))}detach(){this.select([])}}function h(e){const i=new t.PerspectiveCamera(50,1,.01,1e3),n=void 0!==e?e:new t.Vector3(0,5,10);return i.position.copy(n),i.lookAt(new t.Vector3),i}function c(e){const i=window.innerHeight,n=window.innerWidth,s=void 0!==e?e:new t.Vector3(0,5e3,1e4),o=new t.OrthographicCamera(-15,15,i/n*15,i/n*-15,1,1e7);return o.position.copy(s),o.zoom=2.5,o.lookAt(new t.Vector3(0,0,0)),o.updateProjectionMatrix(),o}function l(){return new t.Scene}class d extends t.Group{constructor(e={x:"red",y:"green",z:"blue"},i=10,n=1,s=.5*n){super(),this.colors=e,this.axesLength=i,this.arrowsLength=n,this.arrowsWidth=s,this.type="CoordinateHelper";const o={x:[1,0,0],y:[0,1,0],z:[0,0,1]},r=new t.Vector3;["x","y","z"].forEach((a=>{const h=new t.ArrowHelper(new t.Vector3(...o[a]),r,i,e[a],n,s);h.renderOrder=1/0,this.add(h)})),this.isHelper=!0}setLength(e=10,t=1,i=.5*t){this.traverse((n=>{n.setLength(e,t,i)}))}dispose(){this.traverse((e=>{e.dispose()}))}}class p extends t.LineSegments{constructor(e=10,i=10,n=1,s=1,o=11184810,r=14671839,a=15658734){super(new t.BufferGeometry,new t.LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="CustomGridHelper",this.centerColor=new t.Color(o),this.baseColor=new t.Color(r),this.divsionColor=new t.Color(a),this.width=e,this.height=i,this.divsion=n,this.splice=s,this.update()}update(){let e;e=1===this.splice?1:1/this.splice;const{centerColor:i,baseColor:n,divsionColor:s,width:o,height:r,splice:a,divsion:h}=this,[c,l]=[o/h*a,r/h*a],d=[],p=[];let u,m,w,f=0;function g(e,t,o,r,h){const c={x:(e,t)=>d.push(-t,e,0,t,e,0),y:(e,t)=>d.push(e,-t,0,e,t,0)};for(let l=0,d=-e;l<=o;l++,d+=r)c[h](d,e),m=l%a==0,w=l===t,u=s,w?u=i:m&&!w&&(u=n),u.toArray(p,f),f+=3,u.toArray(p,f),f+=3}g(o/2,c/2,c,e,"x"),g(r/2,l/2,l,e,"y"),this.geometry.setAttribute("position",new t.Float32BufferAttribute(d,3)),this.geometry.setAttribute("color",new t.Float32BufferAttribute(p,3)),this.geometry.attributes.position.needUpdate=!0,this.geometry.attributes.color.needUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}let u=class extends t.Object3D{constructor(e,i){super(),this.object=e,this.isViewHelper=!0,this.animating=!1,this.center=new t.Vector3;const n=new t.Color("#ff3653"),s=new t.Color("#8adb00"),o=new t.Color("#2c8fff"),r=[],a=new t.Raycaster,h=new t.Vector2,c=new t.Object3D,l=new t.OrthographicCamera(-2,2,2,-2,0,4);l.position.set(0,0,2);const d=new t.BoxGeometry(.8,.05,.05).translate(.4,0,0),p=new t.Mesh(d,A(n)),u=new t.Mesh(d,A(s)),m=new t.Mesh(d,A(o));u.rotation.z=Math.PI/2,m.rotation.y=-Math.PI/2,this.add(p),this.add(m),this.add(u);const w=new t.Sprite(j(n,"X"));w.userData.type="posX";const f=new t.Sprite(j(s,"Y"));f.userData.type="posY";const g=new t.Sprite(j(o,"Z"));g.userData.type="posZ";const y=new t.Sprite(j(n));y.userData.type="negX";const b=new t.Sprite(j(s));b.userData.type="negY";const E=new t.Sprite(j(o));E.userData.type="negZ",w.position.x=1,f.position.y=1,g.position.z=1,y.position.x=-1,y.scale.setScalar(.8),b.position.y=-1,b.scale.setScalar(.8),E.position.z=-1,E.scale.setScalar(.8),this.add(w),this.add(f),this.add(g),this.add(y),this.add(b),this.add(E),r.push(w),r.push(f),r.push(g),r.push(y),r.push(b),r.push(E);const v=new t.Vector3,M=128,x=2*Math.PI,P=new t.Quaternion,C=new t.Quaternion,_=new t.Vector4;let S=0;this.render=function(e){this.quaternion.copy(this.object.quaternion).invert(),this.updateMatrixWorld(),v.set(0,0,1),v.applyQuaternion(this.object.quaternion),v.x>=0?(w.material.opacity=1,y.material.opacity=.5):(w.material.opacity=.5,y.material.opacity=1),v.y>=0?(f.material.opacity=1,b.material.opacity=.5):(f.material.opacity=.5,b.material.opacity=1),v.z>=0?(g.material.opacity=1,E.material.opacity=.5):(g.material.opacity=.5,E.material.opacity=1);const t=i.offsetWidth-M;e.clearDepth(),e.getViewport(_),e.setViewport(t,0,M,M),e.render(this,l),e.setViewport(_.x,_.y,_.z,_.w)};const T=new t.Vector3,O=new t.Quaternion;function A(e){return new t.MeshBasicMaterial({color:e,toneMapped:!1})}function j(e,i=null){const n=document.createElement("canvas");n.width=64,n.height=64;const s=n.getContext("2d");s.beginPath(),s.arc(32,32,16,0,2*Math.PI),s.closePath(),s.fillStyle=e.getStyle(),s.fill(),null!==i&&(s.font="24px Arial",s.textAlign="center",s.fillStyle="#000000",s.fillText(i,32,41));const o=new t.CanvasTexture(n);return new t.SpriteMaterial({map:o,toneMapped:!1})}this.handleClick=function(e){if(!0===this.animating)return!1;const n=i.getBoundingClientRect(),s=n.left+(i.offsetWidth-M),o=n.top+(i.offsetHeight-M);h.x=(e.clientX-s)/(n.right-s)*2-1,h.y=-(e.clientY-o)/(n.bottom-o)*2+1,a.setFromCamera(h,l);const d=a.intersectObjects(r);if(d.length>0){const e=d[0],{object:i}=e;return function(e,i,n){switch(e.userData.type){case"posX":T.set(1,0,0),O.setFromEuler(new t.Euler(0,.5*Math.PI,0));break;case"posY":T.set(0,1,0),O.setFromEuler(new t.Euler(.5*-Math.PI,0,0));break;case"posZ":T.set(0,0,1),O.setFromEuler(new t.Euler);break;case"negX":T.set(-1,0,0),O.setFromEuler(new t.Euler(0,.5*-Math.PI,0));break;case"negY":T.set(0,-1,0),O.setFromEuler(new t.Euler(.5*Math.PI,0,0));break;case"negZ":T.set(0,0,-1),O.setFromEuler(new t.Euler(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}S=n.position.distanceTo(i),T.multiplyScalar(S).add(i),c.position.copy(i),c.lookAt(n.position),P.copy(c.quaternion),c.lookAt(T),C.copy(c.quaternion)}(i,this.center,this.object),this.animating=!0,!0}return!1},this.update=function(e){const t=e*x;P.rotateTowards(C,t),this.object.position.set(0,0,1).applyQuaternion(P).multiplyScalar(S).add(this.center),this.object.quaternion.rotateTowards(O,t),0===P.angleTo(C)&&(this.animating=!1)},this.dispose=function(){d.dispose(),p.material.dispose(),u.material.dispose(),m.material.dispose(),w.material.map.dispose(),f.material.map.dispose(),g.material.map.dispose(),y.material.map.dispose(),b.material.map.dispose(),E.material.map.dispose(),w.material.dispose(),f.material.dispose(),g.material.dispose(),y.material.dispose(),b.material.dispose(),E.material.dispose()}}};function m(e){return document.createElement(e)}class w{constructor(e){this.domElement=e}add(){for(let e=0;e<arguments.length;e++){const t=arguments[e];t instanceof w?this.domElement.append(t.domElement):console.warn("UIElement : ",t," is not an instance of UIElement")}}remove(){for(let e=0;e<arguments.length;e++){const t=arguments[e];t instanceof w?this.domElement.removeChild(t.domElement):console.warn("UIElement : ",t," is not an instance of UIElement")}}setStyle(e){Object.assign(this.domElement.style,e)}setTextContent(e){this.domElement.textContent=e}getTextContent(){return this.domElement.textContent}setId(e){this.domElement.id=e}show(){this.domElement.style.display="block"}hide(){this.domElement.style.display="none"}}class f extends w{constructor(){super(m("div"))}}class g extends w{constructor(){super(m("span"))}}class y extends g{constructor(){super(),this.domElement.className="UIText",this.domElement.style.cursor="default",this.domElement.style.display="inline-block",this.domElement.style.fontSize="12px"}}class b extends w{constructor(){super(m("br"))}}class E extends u{constructor(e,t){super(e,t);const i=new f;i.setId("viewHelper"),i.setStyle({position:"absolute",right:"0px",bottom:"0px",height:"128px",width:"128px"}),t.append(i.domElement),i.domElement.addEventListener("pointerup",(e=>{e.stopPropagation(),this.handleClick(e)})),i.domElement.addEventListener("pointerdown",(e=>{e.stopPropagation()}))}}const v={type:"change"},M={type:"start"},x={type:"end"};class P extends t.EventDispatcher{constructor(e,i){super(),void 0===i&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),i===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.zoomToCursor=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this.touches={ONE:t.TOUCH.ROTATE,TWO:t.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",q),this._domElementKeyEvents=e},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(v),n.update(),o=s.NONE},this.update=function(){const i=new t.Vector3,p=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),u=p.clone().invert(),m=new t.Vector3,w=new t.Quaternion,f=2*Math.PI;return function(){const e=n.object.position;i.copy(e).sub(n.target),i.applyQuaternion(p),a.setFromVector3(i),n.autoRotate&&o===s.NONE&&T(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(a.theta+=h.theta*n.dampingFactor,a.phi+=h.phi*n.dampingFactor):(a.theta+=h.theta,a.phi+=h.phi);let t=n.minAzimuthAngle,g=n.maxAzimuthAngle;return isFinite(t)&&isFinite(g)&&(t<-Math.PI?t+=f:t>Math.PI&&(t-=f),g<-Math.PI?g+=f:g>Math.PI&&(g-=f),a.theta=t<=g?Math.max(t,Math.min(g,a.theta)):a.theta>(t+g)/2?Math.max(t,a.theta):Math.min(g,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(n.minDistance,Math.min(n.maxDistance,a.radius)),1==_?n.target.add(l):!0===n.enableDamping?n.target.addScaledVector(l,n.dampingFactor):n.target.add(l),i.setFromSpherical(a),i.applyQuaternion(u),e.copy(n.target).add(i),n.object.lookAt(n.target),!0===_?(l.set(0,0,0),h.set(0,0,0),_=!1):!0===n.enableDamping?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor,l.multiplyScalar(1-n.dampingFactor)):(h.set(0,0,0),l.set(0,0,0)),c=1,!!(d||m.distanceToSquared(n.object.position)>r||8*(1-w.dot(n.object.quaternion))>r)&&(n.dispatchEvent(v),m.copy(n.object.position),w.copy(n.object.quaternion),d=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",W),n.domElement.removeEventListener("pointerdown",B),n.domElement.removeEventListener("pointercancel",F),n.domElement.removeEventListener("wheel",N),n.domElement.removeEventListener("pointermove",G),n.domElement.removeEventListener("pointerup",Z),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",q)};const n=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=s.NONE;const r=1e-6,a=new t.Spherical,h=new t.Spherical;let c=1;const l=new t.Vector3;let d=!1;const p=new t.Vector2,u=new t.Vector2,m=new t.Vector2,w=new t.Vector2,f=new t.Vector2,g=new t.Vector2,y=new t.Vector2,b=new t.Vector2,E=new t.Vector2,P=[],C={};let _=!1;function S(){return Math.pow(.95,n.zoomSpeed)}function T(e){h.theta-=e}function O(e){h.phi-=e}const A=function(){const e=new t.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),l.add(e)}}(),j=function(){const e=new t.Vector3;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),l.add(e)}}(),L=function(){const e=new t.Vector3;return function(t,i){const s=n.domElement;if(n.object.isPerspectiveCamera){const o=n.object.position;e.copy(o).sub(n.target);let r=e.length();r*=Math.tan(n.object.fov/2*Math.PI/180),A(2*t*r/s.clientHeight,n.object.matrix),j(2*i*r/s.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(A(t*(n.object.right-n.object.left)/n.object.zoom/s.clientWidth,n.object.matrix),j(i*(n.object.top-n.object.bottom)/n.object.zoom/s.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function I(e){n.object.isPerspectiveCamera?c/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function R(e){n.object.isPerspectiveCamera?c*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function D(e){p.set(e.clientX,e.clientY)}function Y(e){w.set(e.clientX,e.clientY)}function X(e){n.zoomToCursor?function(e){const i=e.offsetX/n.domElement.clientWidth*2-1,s=-e.offsetY/n.domElement.clientHeight*2+1,o=new t.Vector3(i,s,0);if(o.unproject(n.object),o.sub(n.object.position).setLength(10*n.zoomSpeed),n.object.isPerspectiveCamera)e.deltaY<0?(n.object.position.add(o),n.target.add(o)):(n.object.position.sub(o),n.target.sub(o));else if(n.object.isOrthographicCamera){const t=n.domElement,i=t.getBoundingClientRect(),s=.5*t.clientWidth,o=.5*t.clientHeight,r=(e.clientX-s-i.left)*(1-1/S()),a=(e.clientY-o-i.top)*(1-1/S());e.deltaY<0?(R(S()),L(r,a)):(I(S()),L(-r,-a)),_=!0}}(e):function(e){e.deltaY<0?R(S()):e.deltaY>0&&I(S())}(e),n.update()}function Q(){if(1===P.length)p.set(P[0].pageX,P[0].pageY);else{const e=.5*(P[0].pageX+P[1].pageX),t=.5*(P[0].pageY+P[1].pageY);p.set(e,t)}}function k(){if(1===P.length)w.set(P[0].pageX,P[0].pageY);else{const e=.5*(P[0].pageX+P[1].pageX),t=.5*(P[0].pageY+P[1].pageY);w.set(e,t)}}function V(){const e=P[0].pageX-P[1].pageX,t=P[0].pageY-P[1].pageY,i=Math.sqrt(e*e+t*t);y.set(0,i)}function z(e){if(1==P.length)u.set(e.pageX,e.pageY);else{const t=$(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);u.set(i,n)}m.subVectors(u,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;T(2*Math.PI*m.x/t.clientHeight),O(2*Math.PI*m.y/t.clientHeight),p.copy(u)}function H(e){if(1===P.length)f.set(e.pageX,e.pageY);else{const t=$(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);f.set(i,n)}g.subVectors(f,w).multiplyScalar(n.panSpeed),L(g.x,g.y),w.copy(f)}function U(e){const t=$(e),i=e.pageX-t.x,s=e.pageY-t.y,o=Math.sqrt(i*i+s*s);b.set(0,o),E.set(0,Math.pow(b.y/y.y,n.zoomSpeed)),I(E.y),y.copy(b)}function B(e){!1!==n.enabled&&(0===P.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",G),n.domElement.addEventListener("pointerup",Z)),function(e){P.push(e)}(e),"touch"===e.pointerType?function(e){switch(J(e),P.length){case 1:switch(n.touches.ONE){case t.TOUCH.ROTATE:if(!1===n.enableRotate)return;Q(),o=s.TOUCH_ROTATE;break;case t.TOUCH.PAN:if(!1===n.enablePan)return;k(),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(n.touches.TWO){case t.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&V(),n.enablePan&&k(),o=s.TOUCH_DOLLY_PAN;break;case t.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&V(),n.enableRotate&&Q(),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(M)}(e):function(e){let i;switch(e.button){case 0:i=n.mouseButtons.LEFT;break;case 1:i=n.mouseButtons.MIDDLE;break;case 2:i=n.mouseButtons.RIGHT;break;default:i=-1}switch(i){case t.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(e){y.set(e.clientX,e.clientY)}(e),o=s.DOLLY;break;case t.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;Y(e),o=s.PAN}else{if(!1===n.enableRotate)return;D(e),o=s.ROTATE}break;case t.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;D(e),o=s.ROTATE}else{if(!1===n.enablePan)return;Y(e),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(M)}(e))}function G(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(J(e),o){case s.TOUCH_ROTATE:if(!1===n.enableRotate)return;z(e),n.update();break;case s.TOUCH_PAN:if(!1===n.enablePan)return;H(e),n.update();break;case s.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&U(e),n.enablePan&&H(e)}(e),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&U(e),n.enableRotate&&z(e)}(e),n.update();break;default:o=s.NONE}}(e):function(e){if(!1===n.enabled)return;switch(o){case s.ROTATE:if(!1===n.enableRotate)return;!function(e){u.set(e.clientX,e.clientY),m.subVectors(u,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;T(2*Math.PI*m.x/t.clientHeight),O(2*Math.PI*m.y/t.clientHeight),p.copy(u),n.update()}(e);break;case s.DOLLY:if(!1===n.enableZoom)return;!function(e){b.set(e.clientX,e.clientY),E.subVectors(b,y),E.y>0?I(S()):E.y<0&&R(S()),y.copy(b),n.update()}(e);break;case s.PAN:if(!1===n.enablePan)return;!function(e){f.set(e.clientX,e.clientY),g.subVectors(f,w).multiplyScalar(n.panSpeed),L(g.x,g.y),w.copy(f),n.update()}(e)}}(e))}function Z(e){K(e),0===P.length&&(n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",G),n.domElement.removeEventListener("pointerup",Z)),n.dispatchEvent(x),o=s.NONE}function F(e){K(e)}function N(e){!1!==n.enabled&&!1!==n.enableZoom&&o===s.NONE&&(e.preventDefault(),n.dispatchEvent(M),X(e),n.dispatchEvent(x))}function q(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:L(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:L(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:L(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:L(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function W(e){!1!==n.enabled&&e.preventDefault()}function K(e){delete C[e.pointerId];for(let t=0;t<P.length;t++)if(P[t].pointerId==e.pointerId)return void P.splice(t,1)}function J(e){let i=C[e.pointerId];void 0===i&&(i=new t.Vector2,C[e.pointerId]=i),i.set(e.pageX,e.pageY)}function $(e){const t=e.pointerId===P[0].pointerId?P[1]:P[0];return C[t.pointerId]}n.domElement.addEventListener("contextmenu",W),n.domElement.addEventListener("pointerdown",B),n.domElement.addEventListener("pointercancel",F),n.domElement.addEventListener("wheel",N,{passive:!1}),this.update()}}const C=new t.Raycaster,_=new t.Vector3,S=new t.Vector3,T=new t.Quaternion,O={X:new t.Vector3(1,0,0),Y:new t.Vector3(0,1,0),Z:new t.Vector3(0,0,1)},A={type:"change"},j={type:"mouseDown"},L={type:"mouseUp",mode:null},I={type:"objectChange"};class R extends t.Object3D{constructor(e,i){super(),void 0===i&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const n=new te;this._gizmo=n,this.add(n);const s=new ie;this._plane=s,this.add(s);const o=this;function r(e,t){let i=t;Object.defineProperty(o,e,{get:function(){return void 0!==i?i:t},set:function(t){i!==t&&(i=t,s[e]=t,n[e]=t,o.dispatchEvent({type:e+"-changed",value:t}),o.dispatchEvent(A))}}),o[e]=t,s[e]=t,n[e]=t}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const a=new t.Vector3,h=new t.Vector3,c=new t.Quaternion,l=new t.Quaternion,d=new t.Vector3,p=new t.Quaternion,u=new t.Vector3,m=new t.Vector3,w=new t.Vector3,f=new t.Vector3;r("worldPosition",a),r("worldPositionStart",h),r("worldQuaternion",c),r("worldQuaternionStart",l),r("cameraPosition",d),r("cameraQuaternion",p),r("pointStart",u),r("pointEnd",m),r("rotationAxis",w),r("rotationAngle",0),r("eye",f),this._offset=new t.Vector3,this._startNorm=new t.Vector3,this._endNorm=new t.Vector3,this._cameraScale=new t.Vector3,this._parentPosition=new t.Vector3,this._parentQuaternion=new t.Quaternion,this._parentQuaternionInv=new t.Quaternion,this._parentScale=new t.Vector3,this._worldScaleStart=new t.Vector3,this._worldQuaternionInv=new t.Quaternion,this._worldScale=new t.Vector3,this._positionStart=new t.Vector3,this._quaternionStart=new t.Quaternion,this._scaleStart=new t.Vector3,this._getPointer=D.bind(this),this._onPointerDown=X.bind(this),this._onPointerHover=Y.bind(this),this._onPointerMove=Q.bind(this),this._onPointerUp=k.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;C.setFromCamera(e,this.camera);const t=V(this._gizmo.picker[this.mode],C);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){C.setFromCamera(e,this.camera);const t=V(this._plane,C,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,j.mode=this.mode,this.dispatchEvent(j)}}pointerMove(e){const t=this.axis,i=this.mode,n=this.object;let s=this.space;if("scale"===i?s="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(s="world"),void 0===n||null===t||!1===this.dragging||-1!==e.button)return;C.setFromCamera(e,this.camera);const o=V(this._plane,C,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),"translate"===i)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===s&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===s&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===s&&(n.position.applyQuaternion(T.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),"world"===s&&(n.parent&&n.position.add(_.setFromMatrixPosition(n.parent.matrixWorld)),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(_.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===i){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),S.set(e,e,e)}else _.copy(this.pointStart),S.copy(this.pointEnd),_.applyQuaternion(this._worldQuaternionInv),S.applyQuaternion(this._worldQuaternionInv),S.divide(_),-1===t.search("X")&&(S.x=1),-1===t.search("Y")&&(S.y=1),-1===t.search("Z")&&(S.z=1);n.scale.copy(this._scaleStart).multiply(S),this.scaleSnap&&(-1!==t.search("X")&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===i){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(_.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(_.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(O[t]),_.copy(O[t]),"local"===s&&_.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(_.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===s&&"E"!==t&&"XYZE"!==t?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(T.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(T.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(A),this.dispatchEvent(I)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&(L.mode=this.mode,this.dispatchEvent(L)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(A),this.dispatchEvent(I),this.pointStart.copy(this.pointEnd))}getRaycaster(){return C}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function D(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function Y(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function X(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function Q(e){this.enabled&&this.pointerMove(this._getPointer(e))}function k(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function V(e,t,i){const n=t.intersectObject(e,!0);for(let e=0;e<n.length;e++)if(n[e].object.visible||i)return n[e];return!1}const z=new t.Euler,H=new t.Vector3(0,1,0),U=new t.Vector3(0,0,0),B=new t.Matrix4,G=new t.Quaternion,Z=new t.Quaternion,F=new t.Vector3,N=new t.Matrix4,q=new t.Vector3(1,0,0),W=new t.Vector3(0,1,0),K=new t.Vector3(0,0,1),J=new t.Vector3,$=new t.Vector3,ee=new t.Vector3;class te extends t.Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new t.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new t.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const s=i.clone();s.opacity=.5;const o=e.clone();o.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const a=e.clone();a.color.setHex(255);const h=e.clone();h.color.setHex(16711680),h.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const l=e.clone();l.color.setHex(255),l.opacity=.5;const d=e.clone();d.opacity=.25;const p=e.clone();p.color.setHex(16776960),p.opacity=.25;e.clone().color.setHex(16776960);const u=e.clone();u.color.setHex(7895160);const m=new t.CylinderGeometry(0,.04,.1,12);m.translate(0,.05,0);const w=new t.BoxGeometry(.08,.08,.08);w.translate(0,.04,0);const f=new t.BufferGeometry;f.setAttribute("position",new t.Float32BufferAttribute([0,0,0,1,0,0],3));const g=new t.CylinderGeometry(.0075,.0075,.5,3);function y(e,i){const n=new t.TorusGeometry(e,.0075,3,64,i*Math.PI*2);return n.rotateY(Math.PI/2),n.rotateX(Math.PI/2),n}g.translate(0,.25,0);const b={X:[[new t.Mesh(m,o),[.5,0,0],[0,0,-Math.PI/2]],[new t.Mesh(m,o),[-.5,0,0],[0,0,Math.PI/2]],[new t.Mesh(g,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new t.Mesh(m,r),[0,.5,0]],[new t.Mesh(m,r),[0,-.5,0],[Math.PI,0,0]],[new t.Mesh(g,r)]],Z:[[new t.Mesh(m,a),[0,0,.5],[Math.PI/2,0,0]],[new t.Mesh(m,a),[0,0,-.5],[-Math.PI/2,0,0]],[new t.Mesh(g,a),null,[Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.OctahedronGeometry(.1,0),d.clone()),[0,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),l.clone()),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},E={X:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,.3,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.OctahedronGeometry(.2,0),n)]],XY:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},v={START:[[new t.Mesh(new t.OctahedronGeometry(.01,2),s),null,null,null,"helper"]],END:[[new t.Mesh(new t.OctahedronGeometry(.01,2),s),null,null,null,"helper"]],DELTA:[[new t.Line(function(){const e=new t.BufferGeometry;return e.setAttribute("position",new t.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),s),null,null,null,"helper"]],X:[[new t.Line(f,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new t.Line(f,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new t.Line(f,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new t.Mesh(y(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new t.Mesh(y(.5,.5),o)]],Y:[[new t.Mesh(y(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new t.Mesh(y(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new t.Mesh(y(.75,1),p),null,[0,Math.PI/2,0]]]},x={AXIS:[[new t.Line(f,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={XYZE:[[new t.Mesh(new t.SphereGeometry(.25,10,8),n)]],X:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new t.Mesh(new t.TorusGeometry(.75,.1,2,24),n)]]},C={X:[[new t.Mesh(w,o),[.5,0,0],[0,0,-Math.PI/2]],[new t.Mesh(g,o),[0,0,0],[0,0,-Math.PI/2]],[new t.Mesh(w,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(w,r),[0,.5,0]],[new t.Mesh(g,r)],[new t.Mesh(w,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new t.Mesh(w,a),[0,0,.5],[Math.PI/2,0,0]],[new t.Mesh(g,a),[0,0,0],[Math.PI/2,0,0]],[new t.Mesh(w,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),l),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.BoxGeometry(.1,.1,.1),d.clone())]]},_={X:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,.3,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.2),n),[0,0,0]]]},S={X:[[new t.Line(f,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new t.Line(f,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new t.Line(f,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function T(e){const i=new t.Object3D;for(const t in e)for(let n=e[t].length;n--;){const s=e[t][n][0].clone(),o=e[t][n][1],r=e[t][n][2],a=e[t][n][3],h=e[t][n][4];s.name=t,s.tag=h,o&&s.position.set(o[0],o[1],o[2]),r&&s.rotation.set(r[0],r[1],r[2]),a&&s.scale.set(a[0],a[1],a[2]),s.updateMatrix();const c=s.geometry.clone();c.applyMatrix4(s.matrix),s.geometry=c,s.renderOrder=1/0,s.position.set(0,0,0),s.rotation.set(0,0,0),s.scale.set(1,1,1),i.add(s)}return i}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=T(b)),this.add(this.gizmo.rotate=T(M)),this.add(this.gizmo.scale=T(C)),this.add(this.picker.translate=T(E)),this.add(this.picker.rotate=T(P)),this.add(this.picker.scale=T(_)),this.add(this.helper.translate=T(v)),this.add(this.helper.rotate=T(x)),this.add(this.helper.scale=T(S)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:Z;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let e=0;e<i.length;e++){const n=i[e];let s;if(n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition),s=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(s*this.size/4),"helper"!==n.tag){if(n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const e=.99,i=.2;"X"===n.name&&Math.abs(H.copy(q).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"===n.name&&Math.abs(H.copy(W).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"===n.name&&Math.abs(H.copy(K).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(H.copy(K).applyQuaternion(t).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(H.copy(q).applyQuaternion(t).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(H.copy(W).applyQuaternion(t).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)}else"rotate"===this.mode&&(G.copy(t),H.copy(this.eye).applyQuaternion(T.copy(t).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(B.lookAt(this.eye,U,W)),"X"===n.name&&(T.setFromAxisAngle(q,Math.atan2(-H.y,H.z)),T.multiplyQuaternions(G,T),n.quaternion.copy(T)),"Y"===n.name&&(T.setFromAxisAngle(W,Math.atan2(H.x,H.z)),T.multiplyQuaternions(G,T),n.quaternion.copy(T)),"Z"===n.name&&(T.setFromAxisAngle(K,Math.atan2(H.y,H.x)),T.multiplyQuaternions(G,T),n.quaternion.copy(T)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some((function(e){return n.name===e})))&&(n.material.color.setHex(16776960),n.material.opacity=1)}else n.visible=!1,"AXIS"===n.name?(n.visible=!!this.axis,"X"===this.axis&&(T.setFromEuler(z.set(0,0,0)),n.quaternion.copy(t).multiply(T),Math.abs(H.copy(q).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(T.setFromEuler(z.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(T),Math.abs(H.copy(W).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(T.setFromEuler(z.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(T),Math.abs(H.copy(K).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(T.setFromEuler(z.set(0,Math.PI/2,0)),H.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(B.lookAt(U,H,W)),n.quaternion.multiply(T),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),_.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),_.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(_),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}super.updateMatrixWorld(e)}}class ie extends t.Mesh{constructor(){super(new t.PlaneGeometry(1e5,1e5,2,2),new t.MeshBasicMaterial({visible:!1,wireframe:!0,side:t.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),J.copy(q).applyQuaternion("local"===t?this.worldQuaternion:Z),$.copy(W).applyQuaternion("local"===t?this.worldQuaternion:Z),ee.copy(K).applyQuaternion("local"===t?this.worldQuaternion:Z),H.copy($),this.mode){case"translate":case"scale":switch(this.axis){case"X":H.copy(this.eye).cross(J),F.copy(J).cross(H);break;case"Y":H.copy(this.eye).cross($),F.copy($).cross(H);break;case"Z":H.copy(this.eye).cross(ee),F.copy(ee).cross(H);break;case"XY":F.copy(ee);break;case"YZ":F.copy(J);break;case"XZ":H.copy(ee),F.copy($);break;case"XYZ":case"E":F.set(0,0,0)}break;default:F.set(0,0,0)}0===F.length()?this.quaternion.copy(this.cameraQuaternion):(N.lookAt(_.set(0,0,0),F,H),this.quaternion.setFromRotationMatrix(N)),super.updateMatrixWorld(e)}}var ne=function(){var e=0,t=document.createElement("div");function i(e){return t.appendChild(e.dom),e}function n(i){for(var n=0;n<t.children.length;n++)t.children[n].style.display=n===i?"block":"none";e=i}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(i){i.preventDefault(),n(++e%t.children.length)}),!1);var s=(performance||Date).now(),o=s,r=0,a=i(new ne.Panel("FPS","#0ff","#002")),h=i(new ne.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=i(new ne.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:t,addPanel:i,showPanel:n,begin:function(){s=(performance||Date).now()},end:function(){r++;var e=(performance||Date).now();if(h.update(e-s,200),e>o+1e3&&(a.update(1e3*r/(e-o),100),o=e,r=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:t,setMode:n}};ne.Panel=function(e,t,i){var n=1/0,s=0,o=Math.round,r=o(window.devicePixelRatio||1),a=80*r,h=48*r,c=3*r,l=2*r,d=3*r,p=15*r,u=74*r,m=30*r,w=document.createElement("canvas");w.width=a,w.height=h,w.style.cssText="width:80px;height:48px";var f=w.getContext("2d");return f.font="bold "+9*r+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=i,f.fillRect(0,0,a,h),f.fillStyle=t,f.fillText(e,c,l),f.fillRect(d,p,u,m),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(d,p,u,m),{dom:w,update:function(h,g){n=Math.min(n,h),s=Math.max(s,h),f.fillStyle=i,f.globalAlpha=1,f.fillRect(0,0,a,p),f.fillStyle=t,f.fillText(o(h)+" "+e+" ("+o(n)+"-"+o(s)+")",c,l),f.drawImage(w,d+r,p,u-r,m,d,p,u-r,m),f.fillRect(d+u-r,p,r,m),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(d+u-r,p,r,o((1-h/g)*m))}}};class se extends ne.Panel{constructor(e,t="GPU MS"){super(t,"#f90","#210");let i=!0,n=e.getExtension("EXT_disjoint_timer_query_webgl2");null===n&&(i=!1,n=e.getExtension("EXT_disjoint_timer_query"),null===n&&console.warn("GPUStatsPanel: disjoint_time_query extension not available.")),this.context=e,this.extension=n,this.maxTime=30,this.activeQueries=0,this.startQuery=function(){const e=this.context,t=this.extension;if(null===t)return;let n;i?(n=e.createQuery(),e.beginQuery(t.TIME_ELAPSED_EXT,n)):(n=t.createQueryEXT(),t.beginQueryEXT(t.TIME_ELAPSED_EXT,n)),this.activeQueries++;const s=()=>{let o,r,a;i?(o=e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE),r=e.getParameter(t.GPU_DISJOINT_EXT),a=e.getQueryParameter(n,e.QUERY_RESULT)):(o=t.getQueryObjectEXT(n,t.QUERY_RESULT_AVAILABLE_EXT),r=e.getParameter(t.GPU_DISJOINT_EXT),a=t.getQueryObjectEXT(n,t.QUERY_RESULT_EXT));const h=1e-6*a;o?(r||this.update(h,this.maxTime),this.activeQueries--):!1===e.isContextLost()&&requestAnimationFrame(s)};requestAnimationFrame(s)},this.endQuery=function(){const e=this.extension,t=this.context;null!==e&&(i?t.endQuery(e.TIME_ELAPSED_EXT):e.endQueryEXT(e.TIME_ELAPSED_EXT))}}}class oe{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const re=new t.OrthographicCamera(-1,1,1,-1,0,1),ae=new t.BufferGeometry;ae.setAttribute("position",new t.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),ae.setAttribute("uv",new t.Float32BufferAttribute([0,2,0,0,2,0],2));class he{constructor(e){this._mesh=new t.Mesh(ae,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,re)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class ce extends oe{constructor(e,i,n,s,o){super(),this.scene=e,this.camera=i,this.overrideMaterial=n,this.clearColor=s,this.clearAlpha=void 0!==o?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new t.Color}render(e,t,i){const n=e.autoClear;let s,o;e.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),s=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,s),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),e.autoClear=n}}const le={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class de extends oe{constructor(e,i){super(),this.textureID=void 0!==i?i:"tDiffuse",e instanceof t.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=t.UniformsUtils.clone(e.uniforms),this.material=new t.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new he(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class pe extends oe{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const n=e.getContext(),s=e.state;let o,r;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(o=0,r=1):(o=1,r=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),s.buffers.stencil.setFunc(n.ALWAYS,o,4294967295),s.buffers.stencil.setClear(r),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(n.EQUAL,1,4294967295),s.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),s.buffers.stencil.setLocked(!0)}}class ue extends oe{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class me{constructor(e,i){if(this.renderer=e,void 0===i){const n=e.getSize(new t.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(i=new t.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new de(le),this.clock=new t.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let t=0,n=this.passes.length;t<n;t++){const n=this.passes[t];if(!1!==n.enabled){if(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),n.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),n.needsSwap){if(i){const t=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),i.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==pe&&(n instanceof pe?i=!0:n instanceof ue&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const i=this.renderer.getSize(new t.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(i,n),this.renderTarget2.setSize(i,n);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(i,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}const we="default",fe="move",ge="zoom-in",ye="alias",be={"3D":new t.Vector3(1e3,1e3,1e3),XY:new t.Vector3(0,0,1e3),XZ:new t.Vector3(0,1e3,0),YZ:new t.Vector3(1e3,0,0)},Ee=15;let ve=null,Me=null,xe=null;class Pe{constructor(e,t,i){this.id=e,this.parentId=t,this.ancestorId=i}}class Ce{constructor(){this.scene=new t.Scene,this.textures=new Map,this.materials=new Map,this.geometries=new Map,this._exclusion=[],this.pool=[]}set exclusion(e){this._exclusion=e,this.textures.clear(),this.materials.clear(),this.geometries.clear(),this.pool.length=0,this.scene.children.forEach((e=>this.track(e,!0)))}track(e){this.scene.add(e),this._exclusion.includes(e.type)||this.pool.push(e)}collect(e){xe=e.id;if(0!==e.children.length?e.children.forEach((e=>{this.collect(e),Me=e.id})):Me=e?.parent?.id,void 0!==e.geometry&&this.geometries.set(new Pe(xe,Me,ve),e.geometry),void 0!==e.material){const t=e.material;Array.isArray(t)?t.forEach((e=>{this.materials.set(new Pe(xe,Me,ve),e),this.collectTexture(e)})):(this.materials.set(new Pe(xe,Me,ve),t),this.collectTexture(t))}}collectTexture(e){const t=t=>this.materials.set(new Pe(e.id,Me,ve),t);e.alphaMap&&t(e.alphaMap),e.aoMap&&t(e.aoMap),e.envMap&&t(e.envMap),e.lightMap&&t(e.lightMap),e.map&&t(e.map),e.specularMap&&t(e.specularMap)}release(e){this.scene.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach((e=>e.dispose())):e.material.dispose())}}const _e=new t.Raycaster,Se=[];class Te{constructor(e){this.enable=!0;const t=new g,i=new y,n=new y,s=new y,o=new y;t.add(i),t.add(new b),t.add(n),t.add(new b),t.add(s),t.add(new b),t.add(o),t.setStyle({bottom:"10px",left:"10px",position:"absolute"}),t.setId("Stats");const[r,a,h,c]=["objects : ","vertices : ","triangles : ","frameTime : "];i.setTextContent(r+"0"),n.setTextContent(a+"0"),s.setTextContent(h+"0"),o.setTextContent(c+"0 ms"),this.domElement=t.domElement,this.update=function(){const t=e.scene;let o=0,c=0,l=0;for(let e=0,i=t.children.length;e<i;e++){t.children[e].traverseVisible((e=>{if(o++,e?.isMesh||e?.isPoints){const t=e.geometry;c+=t.attributes.position.count,e.isMesh&&(null!==t.index?l+=t.index.count/3:l+=t.attributes.position.count/3)}}))}i.setTextContent(r+o),n.setTextContent(a+c),s.setTextContent(h+l)},e.signals.sceneRendered.add((e=>{o.setTextContent(c+e.toFixed(2)+" ms")})),e.signals.objectAdded.add(this.update),this.showStats=function(){t.show(),this.update()},this.hideStats=function(){t.hide()}}}return e.CAD=class{constructor(e,i,n){this.height=n||window.innerHeight,this.width=i||window.innerWidth,this._container=e,e.style.position="absolute",this.collector=new Ce,this.renderer=new t.WebGLRenderer({antialias:!0}),this.renderer.setClearColor("#ffffff"),this.renderer.setSize(this.width,this.height),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.autoClear=!1;const s=Ee*(this.height/this.width);this.cameras={"3D":new t.OrthographicCamera(-Ee,Ee,s,-s,1,1e5),"2D":new t.OrthographicCamera(-Ee,Ee,s,-s,1,1e5)},this.mainCamera=this.cameras["3D"],this.cameras["3D"].up.set(0,0,1),this.cameras["3D"].position.copy(be["3D"]),this.cameras["3D"].name="3D",this.deputyCamera=this.cameras["2D"],this.cameras["2D"].up.set(0,0,1),this.cameras["2D"].position.copy(be.XY),this.cameras["2D"].name="2D",this.orbitControls=new P(this.mainCamera,this.renderer.domElement),this.trasnlater=new R(this.mainCamera,this.renderer.domElement),this.viewHelper=new E(this.mainCamera,this.renderer.domElement),this.viewHelper.position.set(.5,.5,0),this.stats=new ne,this.stats.dom.style.position="absolute",this.gpuPanel=new se(this.renderer.getContext()),this.stats.addPanel(this.gpuPanel),this.stats.showPanel(0),this.userData={},this.mainView="3D",e.appendChild(this.stats.dom),e.appendChild(this.renderer.domElement),this.composer=new me(this.renderer),this.renderPass=new ce(this.collector.scene,this.mainCamera),this.composer.addPass(this.renderPass),this.mode="SELECT",this.setMode(this.mode),this.listenerControl(),this.selectChange=()=>{}}add(e){this.collector.track(e)}remove(e){this.collector.release(e)}removeById(e){this.remove(this.collector.scene.getObjectById(e))}setView(e){this.mainView=e,"3D"===e?(this.mainCamera=this.cameras["3D"],this.deputyCamera=this.cameras["2D"]):(this.mainCamera=this.cameras["2D"],this.mainCamera.position.copy(be[e]),this.deputyCamera=this.cameras["3D"],this.mainCamera.updateProjectionMatrix()),this.renderPass.camera=this.viewHelper.editorCamera=this.orbitControls.object=this.mainCamera}setMode(e){this.mode=e,"SELECT"===e?(this.orbitControls.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this._container.style.cursor=we):"ZOOM"===e?(this.orbitControls.mouseButtons={LEFT:t.MOUSE.DOLLY,MIDDLE:t.MOUSE.PAN,RIGHT:t.MOUSE.ROTATE},this._container.style.cursor=ge):"PAN"===e?(this.orbitControls.mouseButtons={LEFT:t.MOUSE.PAN,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.ROTATE},this._container.style.cursor=fe):"ROTATE"===e&&(this.orbitControls.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.PAN,RIGHT:-1},this._container.style.cursor=ye)}render(){requestAnimationFrame((()=>this.render())),this.gpuPanel.startQuery(),this.renderer.clear(),this.composer.render(),this.orbitControls.update(),this.viewHelper.render(this.renderer),this.stats.update(),this.gpuPanel.endQuery()}resize(e,t){this.width=e,this.height=t,this.renderer.setSize(this.width,this.height);const i=Ee*t/e;Object.values(this.cameras).forEach((e=>{e.top=i,e.bottom=-i,e.updateProjectionMatrix()}))}listenerControl(){const e=new t.Vector2;this.renderer.domElement.addEventListener("click",(t=>{e.x=t.clientX/this.width*2-1,e.y=-t.clientY/this.height*2+1,_e.setFromCamera(e,this.mainCamera),Se.length=[],_e.intersectObjects(this.collector.pool,!0,Se),this.selectChange(Se)}))}},e.Collector=Ce,e.CoordinateHelper=d,e.CustomGridHelper=p,e.Editor=class{constructor(e){this.state={},this.signals={windowResize:new o,objectSelected:new o,intersectionsDetected:new o,objectAdded:new o,sceneGraphChanged:new o,viewPortCameraChanged:new o,sceneRendered:new o},this.target=e,this.container=new i(this),this.scene=l(),this.sceneHelper=l(),this.cameras={orthographic:c(),perspective:h()},this.viewPortCamera=this.cameras.orthographic,this.selector=new a(this),this.selected=[]}addObject(e,t,i){e.traverse((e=>{void 0!==e.geometry&&this.addGeometry(e.geometry),void 0!==e.material&&this.addMaterial(e.material),this.container.addObject(e)})),void 0===t?this.scene.add(e):(void 0===i?t.add(e):t.children.slice(i,0,e),e.parent=t),this.signals.objectAdded.dispatch(e),this.signals.sceneGraphChanged.dispatch()}addCamera(e){this.container.addCamera(e)}addGeometry(e){this.container.addGeometry(e)}addMaterial(e){this.container.addMaterial(e)}removeObject(e){this.scene.remove(e)}getObjectByUUID(e,t=!1){return t?this.scene.getObjectByProperty("uuid",e):this.container.getObjectByUUID(e)}getObjectsByProperty(e,t){let i=this.scene.getObjectsByProperty(e,t);const n=this.sceneHelper.getObjectsByProperty(e,t);return n.length>0&&(i=i.concat(n)),i}toggleViewportCamera(){const{orthographic:e,perspective:t}=this.cameras;e===this.viewPortCamera?this.viewPortCamera=t:this.viewPortCamera=e,this.signals.viewPortCameraChanged.dispatch(),this.signals.sceneGraphChanged.dispatch()}setState(e,t){this.state[e]=t}getState(e){return this.state[e]}},e.ViewHelper=E,e.ViewPort=class{constructor(e){const i=e.signals,n=function(e={}){const i=new t.WebGLRenderer(Object.assign({antialias:!0},e));return i.shadowMap.enabled=!0,i.shadowMapSoft=!0,i.shadowMap.type=t.PCFSoftShadowMap,i.setClearColor(11184810),i}();n.setAnimationLoop((function(){const e=j.getDelta();!0===d.animating&&(d.update(e),l=!0);!0===l&&f()}));const s=e.scene,o=e.sceneHelper,r=e.target;r.append(n.domElement);const a=new t.GridHelper(50,50,8947848);a.isHelper=!0;const h=new R(e.viewPortCamera,r);h.addEventListener("change",(function(){const e=h.object;void 0!==e&&(p.setFromObject(e,!0),f())})),h.addEventListener("mouseDown",(function(){const e=h.object;void 0!==e&&(y=e.position.clone(),b=e.rotation.clone(),v=e.scale.clone(),c.enabled=!1)})),h.addEventListener("mouseUp",(function(){const e=h.object;if(void 0!==e){switch(h.getMode){case"translate":y.equals(e.position);break;case"rotate":b.equals(e.rotation);break;case"scale":v.equals(e.scale)}c.enabled=!0}})),o.add(h);const c=new P(e.viewPortCamera,r);let l=!1;c.addEventListener("change",(()=>{l=!0}));const d=new E(e.viewPortCamera,r),p=new t.Box3,u=new t.Box3Helper(p);let m,w;function f(){m=performance.now(),n.render(s,e.viewPortCamera),n.autoClear=!1,o.add(a),n.render(o,e.viewPortCamera),o.remove(a),d.render(n),n.autoClear=!0,l=!1,w=performance.now(),i.sceneRendered.dispatch(w-m)}function g(){const{width:t,height:i}=r.getBoundingClientRect(),s=e.viewPortCamera;n.setSize(t,i),"OrthographicCamera"===s.type?(s.top=i/t*15,s.bottom=i/t*-15):"PerspectiveCamera"===s.type&&(s.aspect=t/i),s.updateProjectionMatrix()}u.visible=!1,u.material.transparent=!0,u.material.depthTest=!1,o.add(u),this.stats=new Te(e),r.append(this.stats.domElement);let y=null,b=null,v=null;const M=new t.Raycaster,x=new t.Vector2;function C(t){x.set(2*t.x-1,-2*t.y+1),M.setFromCamera(x,e.viewPortCamera);const i=[];s.traverseVisible((e=>{i.push(e)}));for(let e=0,t=o.children.length;e<t;e++){const t=o.children[e];t.uuid!==h.uuid&&t.uuid!==u.uuid&&t.visible&&i.push(o.children[e])}return M.intersectObjects(i,!1)}const _=new t.Vector2,S=new t.Vector2,T=new t.Vector2;function O(e,t){const{left:i,top:n,width:s,height:o}=r.getBoundingClientRect();return[(e-i)/s,(t-n)/o]}function A(e){const t=O(e.clientX,e.clientY);S.fromArray(t),function(){if(0===_.distanceTo(S)){const e=C(S);console.log(e,"handelClick");const t=e.map((e=>e?.object?.uuid)).filter((e=>void 0!==e));i.intersectionsDetected.dispatch(t),f()}}(),r.removeEventListener("mouseup",A)}r.addEventListener("mousedown",(function(e){const t=O(e.clientX,e.clientY);_.fromArray(t),r.addEventListener("mouseup",A)})),r.addEventListener("dblclick",(function(e){const t=O(e.clientX,e.clientY);T.fromArray(t);const i=C(T);i.length>0&&i[0]}));const j=new t.Clock;i.windowResize.add((()=>{var e;e="editor resized",console.count(`info:${e}`),g(),f()})),i.windowResize.dispatch(),i.objectSelected.add((t=>{h.detach(),u.visible=!1;const i=e.getObjectByUUID(t[0]);!function(...e){console.log(...e)}("signals.objectSelected->",i),void 0!==i&&i!==s&&i!==e.viewPortCamera&&(p.setFromObject(i,!0),!1===p.isEmpty()&&(u.visible=!0),h.attach(i))})),i.sceneGraphChanged.add((()=>{f()})),i.viewPortCameraChanged.add((()=>{h.camera=e.viewPortCamera,c.object=e.viewPortCamera,d.object=e.viewPortCamera,e.viewPortCamera.lookAt(c.target),g()}))}},e}({},THREE);
