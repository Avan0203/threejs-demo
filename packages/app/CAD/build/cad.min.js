var version=function(e,t){"use strict";class n{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e,...t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.slice(0);for(let n=0,i=e.length;n<i;n++)e[n].call(this,...t)}}}class i{constructor(){this.cameras=new Map,this.lights=new Map,this.objects=new Map,this.geometries=new Map,this.materials=new Map,this.helpers=new Map,this.textures=new Map,this.geometriesRefCounter=new Map,this.materialsRefCounter=new Map,this.texturesRefCounter=new Map}addCamera(e){e?.isCamera?this.cameras.set(e.uuid,e):console.error("Editor.Container.addCamera: object not an instance of THREE.Camera.",e)}removeCamera(e){this.cameras.delete(e?.uuid)}addLight(e){e?.isLight?this.lights.set(e.uuid,e):console.error("Editor.Container.addLight: object not an instance of THREE.Light.",e)}removeLight(e){this.lights.delete(e?.uuid)}addObject(e){e?.isObject3D?this.objects.set(e.uuid,e):console.error("Editor.Container.addObject: object not an instance of THREE.Object3D.",e)}removeObject(e){this.objects.delete(e?.uuid)}getObjectByUuid(e){return this.objects.get(e)}addGeometry(e){e?.isBufferGeometry?this.addObjectToRefCounter(e,this.geometriesRefCounter,this.geometries):console.error("Editor.Container.addGeometry: object not an instance of THREE.BufferGeometry.",e)}removeGeometry(e){this.removeObjectToRefCounter(e,this.geometriesRefCounter,this.geometries)}getGeometryByUUID(e){return this.geometries.get(e)}addMaterial(e){if(Array.isArray(e))for(let t=0,n=e.length;t<n;t++){if(!e[t]?.isMaterial){console.error("Editor.Container.addMaterial: object not an instance of THREE.Material in Material Array.",e[t]);break}this.addObjectToRefCounter(e[t],this.materialsRefCounter,this.materials)}else e?.isMaterial?this.addObjectToRefCounter(e,this.materialsRefCounter,this.materials):console.error("Editor.Container.addMaterial: object not an instance of THREE.Material.",e)}removeMaterial(e){if(Array.isArray(e))for(let t=0,n=e.length;t<n;t++)this.removeObjectToRefCounter(e[t],this.materialsRefCounter,this.materials);else this.removeObjectToRefCounter(e,this.materialsRefCounter,this.materials)}getMaterialByUUID(e){return this.materials.get(e)}addTexture(e){e?.isTexture?this.addObjectToRefCounter(e,this.texturesRefCounter,this.textures):console.error("Editor.Container.addTexture: object not an instance of THREE.Texture.",e)}removeTexture(e){this.removeObjectToRefCounter(e,this.texturesRefCounter,this.textures)}getTextureByUUID(e){return this.textures.get(e)}addHelper(e){this.helpers.set(e?.uuid,e)}removeHelper(e){this.helpers.has(e?.uuid)&&this.helpers.delete(e.uuid)}getHelperByUUID(e){return this.helpers.get(e)}addObjectToRefCounter(e,t,n){let i=t.get(e.uuid);void 0===i?(n.set(e.uuid,e),t.set(e.uuid,1)):t.set(e.uuid,i++)}removeObjectToRefCounter(e,t,n){let i=t.get(e.uuid);i--,0===i?(t.delete(e.uuid),n.delete(e.uuid)):t.set(e.uuid,i)}}
/** @license
   * JS Signals <http://millermedeiros.github.com/js-signals/>
   * Released under the MIT license
   * Author: Miller Medeiros
   * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
   */function o(e,t,n,i,o){this._listener=t,this._isOnce=n,this.context=i,this._signal=e,this._priority=o||0}function s(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function a(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){a.prototype.dispatch.apply(e,arguments)}}function r(e){return JSON.stringify(e)}o.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},a.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,n,i){var s,a=this._indexOfListener(e,n);if(-1!==a){if((s=this._bindings[a]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else s=new o(this,e,t,n,i),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,i=this._bindings.length;i--;)if((n=this._bindings[i])._listener===e&&n.context===t)return i;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return s(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return s(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){s(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=n),i){t=this._bindings.slice(),this._shouldPropagate=!0;do{i--}while(t[i]&&this._shouldPropagate&&!1!==t[i].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};class c{constructor(e){this.multipleSelect=!1,this.editor=e,this.signals=e.signals,this.signals.intersectionsDetected.add((e=>{e.length>0?this.multipleSelect?this.select([e[0]]):this.select(e):this.detach([])}))}select(e){var t,n;(t=this.editor.selected,n=e,r(t.slice().sort())!==r(n.slice().sort()))&&(this.editor.selected=e,this.signals.objectSelected.dispatch(e),this.editor.dispatchEvent("selectionChange",e))}detach(){this.editor.selected=[],this.signals.objectSelected.dispatch([]),this.editor.dispatchEvent("selectionChange",[])}}function h(e){const n=new t.PerspectiveCamera(50,1,.01,1e3),i=void 0!==e?e:new t.Vector3(0,5,10);return n.position.copy(i),n.up.set(0,0,1),n.lookAt(new t.Vector3),n}function l(e){const n=window.innerHeight,i=window.innerWidth,o=void 0!==e?e:new t.Vector3(5e3,-5e3,1e4),s=new t.OrthographicCamera(-15,15,n/i*15,n/i*-15,1,1e7);return s.position.copy(o),s.zoom=2.5,s.up.set(0,0,1),s.lookAt(new t.Vector3(0,0,0)),s.updateProjectionMatrix(),s}function d(){return new t.Scene}class p extends t.Group{constructor(e={x:"red",y:"green",z:"blue"},n=10,i=1,o=.5*i){super(),this.colors=e,this.axesLength=n,this.arrowsLength=i,this.arrowsWidth=o,this.type="CoordinateHelper";const s={x:[1,0,0],y:[0,1,0],z:[0,0,1]},a=new t.Vector3;["x","y","z"].forEach((r=>{const c=new t.ArrowHelper(new t.Vector3(...s[r]),a,n,e[r],i,o);c.renderOrder=1/0,this.add(c)})),this.isHelper=!0}setLength(e=10,t=1,n=.5*t){this.traverse((i=>{i.setLength(e,t,n)}))}dispose(){this.traverse((e=>{e.dispose()}))}}class u extends t.LineSegments{constructor(e=10,n=10,i=1,o=1,s=11184810,a=14671839,r=15658734){super(new t.BufferGeometry,new t.LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="CustomGridHelper",this.centerColor=new t.Color(s),this.baseColor=new t.Color(a),this.divisionColor=new t.Color(r),this.width=e,this.height=n,this.division=i,this.splice=o,this.update()}update(){let e;e=1===this.splice?1:1/this.splice;const{centerColor:n,baseColor:i,divisionColor:o,width:s,height:a,splice:r,division:c}=this,[h,l]=[s/c*r,a/c*r],d=[],p=[];let u,m,w,y=0;function g(e,t,s,a,c){const h={x:(e,t)=>d.push(-t,e,0,t,e,0),y:(e,t)=>d.push(e,-t,0,e,t,0)};for(let l=0,d=-e;l<=s;l++,d+=a)h[c](d,e),m=l%r==0,w=l===t,u=o,w?u=n:m&&!w&&(u=i),u.toArray(p,y),y+=3,u.toArray(p,y),y+=3}g(s/2,h/2,h,e,"x"),g(a/2,l/2,l,e,"y"),this.geometry.setAttribute("position",new t.Float32BufferAttribute(d,3)),this.geometry.setAttribute("color",new t.Float32BufferAttribute(p,3)),this.geometry.attributes.position.needUpdate=!0,this.geometry.attributes.color.needUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}let m=class extends t.Object3D{constructor(e,n){super(),this.object=e,this.isViewHelper=!0,this.animating=!1,this.center=new t.Vector3;const i=new t.Color("#ff3653"),o=new t.Color("#8adb00"),s=new t.Color("#2c8fff"),a=[],r=new t.Raycaster,c=new t.Vector2,h=new t.Object3D,l=new t.OrthographicCamera(-2,2,2,-2,0,4);l.position.set(0,0,2);const d=new t.BoxGeometry(.8,.05,.05).translate(.4,0,0),p=new t.Mesh(d,T(i)),u=new t.Mesh(d,T(o)),m=new t.Mesh(d,T(s));u.rotation.z=Math.PI/2,m.rotation.y=-Math.PI/2,this.add(p),this.add(m),this.add(u);const w=new t.Sprite(A(i,"X"));w.userData.type="posX";const y=new t.Sprite(A(o,"Y"));y.userData.type="posY";const g=new t.Sprite(A(s,"Z"));g.userData.type="posZ";const b=new t.Sprite(A(i));b.userData.type="negX";const f=new t.Sprite(A(o));f.userData.type="negY";const v=new t.Sprite(A(s));v.userData.type="negZ",w.position.x=1,y.position.y=1,g.position.z=1,b.position.x=-1,f.position.y=-1,v.position.z=-1,this.add(w),this.add(y),this.add(g),this.add(b),this.add(f),this.add(v),a.push(w),a.push(y),a.push(g),a.push(b),a.push(f),a.push(v);const M=new t.Vector3,E=128,x=2*Math.PI,P=new t.Quaternion,C=new t.Quaternion,_=new t.Vector4;let S=0;this.render=function(e){this.quaternion.copy(this.object.quaternion).invert(),this.updateMatrixWorld(),M.set(0,0,1),M.applyQuaternion(this.object.quaternion),M.x>=0?(w.material.opacity=1,b.material.opacity=.5):(w.material.opacity=.5,b.material.opacity=1),M.y>=0?(y.material.opacity=1,f.material.opacity=.5):(y.material.opacity=.5,f.material.opacity=1),M.z>=0?(g.material.opacity=1,v.material.opacity=.5):(g.material.opacity=.5,v.material.opacity=1);const t=n.offsetWidth-E;e.clearDepth(),e.getViewport(_),e.setViewport(t,0,E,E),e.render(this,l),e.setViewport(_.x,_.y,_.z,_.w)};const O=new t.Vector3,j=new t.Quaternion;function T(e){return new t.MeshBasicMaterial({color:e,toneMapped:!1})}function A(e,n=null){const i=document.createElement("canvas");i.width=64,i.height=64;const o=i.getContext("2d");o.beginPath(),o.arc(32,32,16,0,2*Math.PI),o.closePath(),o.fillStyle=e.getStyle(),o.fill(),null!==n&&(o.font="24px Arial",o.textAlign="center",o.fillStyle="#000000",o.fillText(n,32,41));const s=new t.CanvasTexture(i);return new t.SpriteMaterial({map:s,toneMapped:!1})}this.handleClick=function(e){if(!0===this.animating)return!1;const i=n.getBoundingClientRect(),o=i.left+(n.offsetWidth-E),s=i.top+(n.offsetHeight-E);c.x=(e.clientX-o)/(i.right-o)*2-1,c.y=-(e.clientY-s)/(i.bottom-s)*2+1,r.setFromCamera(c,l);const d=r.intersectObjects(a);if(d.length>0){const e=d[0],{object:n}=e;return function(e,n,i){switch(e.userData.type){case"posX":O.set(1,0,0),j.setFromEuler(new t.Euler(0,.5*Math.PI,0));break;case"posY":O.set(0,1,0),j.setFromEuler(new t.Euler(.5*-Math.PI,0,0));break;case"posZ":O.set(0,0,1),j.setFromEuler(new t.Euler);break;case"negX":O.set(-1,0,0),j.setFromEuler(new t.Euler(0,.5*-Math.PI,0));break;case"negY":O.set(0,-1,0),j.setFromEuler(new t.Euler(.5*Math.PI,0,0));break;case"negZ":O.set(0,0,-1),j.setFromEuler(new t.Euler(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}S=i.position.distanceTo(n),O.multiplyScalar(S).add(n),h.position.copy(n),h.lookAt(i.position),P.copy(h.quaternion),h.lookAt(O),C.copy(h.quaternion)}(n,this.center,this.object),this.animating=!0,!0}return!1},this.update=function(e){const t=e*x;P.rotateTowards(C,t),this.object.position.set(0,0,1).applyQuaternion(P).multiplyScalar(S).add(this.center),this.object.quaternion.rotateTowards(j,t),0===P.angleTo(C)&&(this.animating=!1)},this.dispose=function(){d.dispose(),p.material.dispose(),u.material.dispose(),m.material.dispose(),w.material.map.dispose(),y.material.map.dispose(),g.material.map.dispose(),b.material.map.dispose(),f.material.map.dispose(),v.material.map.dispose(),w.material.dispose(),y.material.dispose(),g.material.dispose(),b.material.dispose(),f.material.dispose(),v.material.dispose()}}};function w(e){return document.createElement(e)}class y{constructor(e){this.domElement=e}add(...e){for(let t=0;t<e.length;t++){const n=e[t];n instanceof y?this.domElement.append(n.domElement):console.warn("UIElement : ",n," is not an instance of UIElement")}}remove(...e){for(let t=0;t<e.length;t++){const n=e[t];n instanceof y?this.domElement.removeChild(n.domElement):console.warn("UIElement : ",n," is not an instance of UIElement")}}setStyle(e){Object.assign(this.domElement.style,e)}setTextContent(e){this.domElement.textContent=e}getTextContent(){return this.domElement.textContent}setId(e){this.domElement.id=e}show(){this.domElement.style.display="block"}hide(){this.domElement.style.display="none"}}class g extends y{constructor(){super(w("div"))}}class b extends y{constructor(){super(w("span"))}}class f extends b{constructor(){super(),this.domElement.className="UIText",this.domElement.style.cursor="default",this.domElement.style.display="inline-block",this.domElement.style.fontSize="12px"}}class v extends y{constructor(){super(w("br"))}}class M extends m{constructor(e,t){super(e,t);const n=new g;n.setId("viewHelper"),n.setStyle({position:"absolute",right:"0px",bottom:"0px",height:"128px",width:"128px"}),t.append(n.domElement),n.domElement.addEventListener("pointerup",(e=>{e.stopPropagation(),this.handleClick(e)})),n.domElement.addEventListener("pointerdown",(e=>{e.stopPropagation()}))}}const E={type:"change"},x={type:"start"},P={type:"end"};class C extends t.EventDispatcher{constructor(e,n){super(),void 0===n&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.zoomToCursor=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this.touches={ONE:t.TOUCH.ROTATE,TWO:t.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",q),this._domElementKeyEvents=e},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(E),i.update(),s=o.NONE},this.update=function(){const n=new t.Vector3,p=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),u=p.clone().invert(),m=new t.Vector3,w=new t.Quaternion,y=2*Math.PI;return function(){const e=i.object.position;n.copy(e).sub(i.target),n.applyQuaternion(p),r.setFromVector3(n),i.autoRotate&&s===o.NONE&&O(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(r.theta+=c.theta*i.dampingFactor,r.phi+=c.phi*i.dampingFactor):(r.theta+=c.theta,r.phi+=c.phi);let t=i.minAzimuthAngle,g=i.maxAzimuthAngle;return isFinite(t)&&isFinite(g)&&(t<-Math.PI?t+=y:t>Math.PI&&(t-=y),g<-Math.PI?g+=y:g>Math.PI&&(g-=y),r.theta=t<=g?Math.max(t,Math.min(g,r.theta)):r.theta>(t+g)/2?Math.max(t,r.theta):Math.min(g,r.theta)),r.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,r.phi)),r.makeSafe(),r.radius*=h,r.radius=Math.max(i.minDistance,Math.min(i.maxDistance,r.radius)),1==_?i.target.add(l):!0===i.enableDamping?i.target.addScaledVector(l,i.dampingFactor):i.target.add(l),n.setFromSpherical(r),n.applyQuaternion(u),e.copy(i.target).add(n),i.object.lookAt(i.target),!0===_?(l.set(0,0,0),c.set(0,0,0),_=!1):!0===i.enableDamping?(c.theta*=1-i.dampingFactor,c.phi*=1-i.dampingFactor,l.multiplyScalar(1-i.dampingFactor)):(c.set(0,0,0),l.set(0,0,0)),h=1,!!(d||m.distanceToSquared(i.object.position)>a||8*(1-w.dot(i.object.quaternion))>a)&&(i.dispatchEvent(E),m.copy(i.object.position),w.copy(i.object.quaternion),d=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",W),i.domElement.removeEventListener("pointerdown",D),i.domElement.removeEventListener("pointercancel",U),i.domElement.removeEventListener("wheel",F),i.domElement.removeEventListener("pointermove",B),i.domElement.removeEventListener("pointerup",N),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",q)};const i=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=o.NONE;const a=1e-6,r=new t.Spherical,c=new t.Spherical;let h=1;const l=new t.Vector3;let d=!1;const p=new t.Vector2,u=new t.Vector2,m=new t.Vector2,w=new t.Vector2,y=new t.Vector2,g=new t.Vector2,b=new t.Vector2,f=new t.Vector2,v=new t.Vector2,M=[],C={};let _=!1;function S(){return Math.pow(.95,i.zoomSpeed)}function O(e){c.theta-=e}function j(e){c.phi-=e}const T=function(){const e=new t.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),l.add(e)}}(),A=function(){const e=new t.Vector3;return function(t,n){!0===i.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),l.add(e)}}(),I=function(){const e=new t.Vector3;return function(t,n){const o=i.domElement;if(i.object.isPerspectiveCamera){const s=i.object.position;e.copy(s).sub(i.target);let a=e.length();a*=Math.tan(i.object.fov/2*Math.PI/180),T(2*t*a/o.clientHeight,i.object.matrix),A(2*n*a/o.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(T(t*(i.object.right-i.object.left)/i.object.zoom/o.clientWidth,i.object.matrix),A(n*(i.object.top-i.object.bottom)/i.object.zoom/o.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function L(e){i.object.isPerspectiveCamera?h/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Y(e){i.object.isPerspectiveCamera?h*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function R(e){p.set(e.clientX,e.clientY)}function X(e){w.set(e.clientX,e.clientY)}function V(e){i.zoomToCursor?function(e){const n=e.offsetX/i.domElement.clientWidth*2-1,o=-e.offsetY/i.domElement.clientHeight*2+1,s=new t.Vector3(n,o,0);if(s.unproject(i.object),s.sub(i.object.position).setLength(10*i.zoomSpeed),i.object.isPerspectiveCamera)e.deltaY<0?(i.object.position.add(s),i.target.add(s)):(i.object.position.sub(s),i.target.sub(s));else if(i.object.isOrthographicCamera){const t=i.domElement,n=t.getBoundingClientRect(),o=.5*t.clientWidth,s=.5*t.clientHeight,a=(e.clientX-o-n.left)*(1-1/S()),r=(e.clientY-s-n.top)*(1-1/S());e.deltaY<0?(Y(S()),I(a,r)):(L(S()),I(-a,-r)),_=!0}}(e):function(e){e.deltaY<0?Y(S()):e.deltaY>0&&L(S())}(e),i.update()}function k(){if(1===M.length)p.set(M[0].pageX,M[0].pageY);else{const e=.5*(M[0].pageX+M[1].pageX),t=.5*(M[0].pageY+M[1].pageY);p.set(e,t)}}function H(){if(1===M.length)w.set(M[0].pageX,M[0].pageY);else{const e=.5*(M[0].pageX+M[1].pageX),t=.5*(M[0].pageY+M[1].pageY);w.set(e,t)}}function z(){const e=M[0].pageX-M[1].pageX,t=M[0].pageY-M[1].pageY,n=Math.sqrt(e*e+t*t);b.set(0,n)}function G(e){if(1==M.length)u.set(e.pageX,e.pageY);else{const t=J(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);u.set(n,i)}m.subVectors(u,p).multiplyScalar(i.rotateSpeed);const t=i.domElement;O(2*Math.PI*m.x/t.clientHeight),j(2*Math.PI*m.y/t.clientHeight),p.copy(u)}function Z(e){if(1===M.length)y.set(e.pageX,e.pageY);else{const t=J(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);y.set(n,i)}g.subVectors(y,w).multiplyScalar(i.panSpeed),I(g.x,g.y),w.copy(y)}function Q(e){const t=J(e),n=e.pageX-t.x,o=e.pageY-t.y,s=Math.sqrt(n*n+o*o);f.set(0,s),v.set(0,Math.pow(f.y/b.y,i.zoomSpeed)),L(v.y),b.copy(f)}function D(e){!1!==i.enabled&&(0===M.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",B),i.domElement.addEventListener("pointerup",N)),function(e){M.push(e)}(e),"touch"===e.pointerType?function(e){switch($(e),M.length){case 1:switch(i.touches.ONE){case t.TOUCH.ROTATE:if(!1===i.enableRotate)return;k(),s=o.TOUCH_ROTATE;break;case t.TOUCH.PAN:if(!1===i.enablePan)return;H(),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(i.touches.TWO){case t.TOUCH.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&z(),i.enablePan&&H(),s=o.TOUCH_DOLLY_PAN;break;case t.TOUCH.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&z(),i.enableRotate&&k(),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&i.dispatchEvent(x)}(e):function(e){let n;switch(e.button){case 0:n=i.mouseButtons.LEFT;break;case 1:n=i.mouseButtons.MIDDLE;break;case 2:n=i.mouseButtons.RIGHT;break;default:n=-1}switch(n){case t.MOUSE.DOLLY:if(!1===i.enableZoom)return;!function(e){b.set(e.clientX,e.clientY)}(e),s=o.DOLLY;break;case t.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;X(e),s=o.PAN}else{if(!1===i.enableRotate)return;R(e),s=o.ROTATE}break;case t.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;R(e),s=o.ROTATE}else{if(!1===i.enablePan)return;X(e),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&i.dispatchEvent(x)}(e))}function B(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch($(e),s){case o.TOUCH_ROTATE:if(!1===i.enableRotate)return;G(e),i.update();break;case o.TOUCH_PAN:if(!1===i.enablePan)return;Z(e),i.update();break;case o.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&Q(e),i.enablePan&&Z(e)}(e),i.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&Q(e),i.enableRotate&&G(e)}(e),i.update();break;default:s=o.NONE}}(e):function(e){if(!1===i.enabled)return;switch(s){case o.ROTATE:if(!1===i.enableRotate)return;!function(e){u.set(e.clientX,e.clientY),m.subVectors(u,p).multiplyScalar(i.rotateSpeed);const t=i.domElement;O(2*Math.PI*m.x/t.clientHeight),j(2*Math.PI*m.y/t.clientHeight),p.copy(u),i.update()}(e);break;case o.DOLLY:if(!1===i.enableZoom)return;!function(e){f.set(e.clientX,e.clientY),v.subVectors(f,b),v.y>0?L(S()):v.y<0&&Y(S()),b.copy(f),i.update()}(e);break;case o.PAN:if(!1===i.enablePan)return;!function(e){y.set(e.clientX,e.clientY),g.subVectors(y,w).multiplyScalar(i.panSpeed),I(g.x,g.y),w.copy(y),i.update()}(e)}}(e))}function N(e){K(e),0===M.length&&(i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",B),i.domElement.removeEventListener("pointerup",N)),i.dispatchEvent(P),s=o.NONE}function U(e){K(e)}function F(e){!1!==i.enabled&&!1!==i.enableZoom&&s===o.NONE&&(e.preventDefault(),i.dispatchEvent(x),V(e),i.dispatchEvent(P))}function q(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){let t=!1;switch(e.code){case i.keys.UP:I(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:I(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:I(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:I(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function W(e){!1!==i.enabled&&e.preventDefault()}function K(e){delete C[e.pointerId];for(let t=0;t<M.length;t++)if(M[t].pointerId==e.pointerId)return void M.splice(t,1)}function $(e){let n=C[e.pointerId];void 0===n&&(n=new t.Vector2,C[e.pointerId]=n),n.set(e.pageX,e.pageY)}function J(e){const t=e.pointerId===M[0].pointerId?M[1]:M[0];return C[t.pointerId]}i.domElement.addEventListener("contextmenu",W),i.domElement.addEventListener("pointerdown",D),i.domElement.addEventListener("pointercancel",U),i.domElement.addEventListener("wheel",F,{passive:!1}),this.update()}}const _=new t.Raycaster,S=new t.Vector3,O=new t.Vector3,j=new t.Quaternion,T={X:new t.Vector3(1,0,0),Y:new t.Vector3(0,1,0),Z:new t.Vector3(0,0,1)},A={type:"change"},I={type:"mouseDown"},L={type:"mouseUp",mode:null},Y={type:"objectChange"};class R extends t.Object3D{constructor(e,n){super(),void 0===n&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),n=document),this.isTransformControls=!0,this.visible=!1,this.domElement=n,this.domElement.style.touchAction="none";const i=new ne;this._gizmo=i,this.add(i);const o=new ie;this._plane=o,this.add(o);const s=this;function a(e,t){let n=t;Object.defineProperty(s,e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,o[e]=t,i[e]=t,s.dispatchEvent({type:e+"-changed",value:t}),s.dispatchEvent(A))}}),s[e]=t,o[e]=t,i[e]=t}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const r=new t.Vector3,c=new t.Vector3,h=new t.Quaternion,l=new t.Quaternion,d=new t.Vector3,p=new t.Quaternion,u=new t.Vector3,m=new t.Vector3,w=new t.Vector3,y=new t.Vector3;a("worldPosition",r),a("worldPositionStart",c),a("worldQuaternion",h),a("worldQuaternionStart",l),a("cameraPosition",d),a("cameraQuaternion",p),a("pointStart",u),a("pointEnd",m),a("rotationAxis",w),a("rotationAngle",0),a("eye",y),this._offset=new t.Vector3,this._startNorm=new t.Vector3,this._endNorm=new t.Vector3,this._cameraScale=new t.Vector3,this._parentPosition=new t.Vector3,this._parentQuaternion=new t.Quaternion,this._parentQuaternionInv=new t.Quaternion,this._parentScale=new t.Vector3,this._worldScaleStart=new t.Vector3,this._worldQuaternionInv=new t.Quaternion,this._worldScale=new t.Vector3,this._positionStart=new t.Vector3,this._quaternionStart=new t.Quaternion,this._scaleStart=new t.Vector3,this._getPointer=X.bind(this),this._onPointerDown=k.bind(this),this._onPointerHover=V.bind(this),this._onPointerMove=H.bind(this),this._onPointerUp=z.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;_.setFromCamera(e,this.camera);const t=G(this._gizmo.picker[this.mode],_);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){_.setFromCamera(e,this.camera);const t=G(this._plane,_,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,I.mode=this.mode,this.dispatchEvent(I)}}pointerMove(e){const t=this.axis,n=this.mode,i=this.object;let o=this.space;if("scale"===n?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0===i||null===t||!1===this.dragging||-1!==e.button)return;_.setFromCamera(e,this.camera);const s=G(this._plane,_,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),"translate"===n)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===o&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===o&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===o&&(i.position.applyQuaternion(j.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),"world"===o&&(i.parent&&i.position.add(S.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(S.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),O.set(e,e,e)}else S.copy(this.pointStart),O.copy(this.pointEnd),S.applyQuaternion(this._worldQuaternionInv),O.applyQuaternion(this._worldQuaternionInv),O.divide(S),-1===t.search("X")&&(O.x=1),-1===t.search("Y")&&(O.y=1),-1===t.search("Z")&&(O.z=1);i.scale.copy(this._scaleStart).multiply(O),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(S.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(S.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(T[t]),S.copy(T[t]),"local"===o&&S.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(S.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===o&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(j.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(j.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(A),this.dispatchEvent(Y)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&(L.mode=this.mode,this.dispatchEvent(L)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(A),this.dispatchEvent(Y),this.pointStart.copy(this.pointEnd))}getRaycaster(){return _}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function X(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function V(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function k(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function H(e){this.enabled&&this.pointerMove(this._getPointer(e))}function z(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function G(e,t,n){const i=t.intersectObject(e,!0);for(let e=0;e<i.length;e++)if(i[e].object.visible||n)return i[e];return!1}const Z=new t.Euler,Q=new t.Vector3(0,1,0),D=new t.Vector3(0,0,0),B=new t.Matrix4,N=new t.Quaternion,U=new t.Quaternion,F=new t.Vector3,q=new t.Matrix4,W=new t.Vector3(1,0,0),K=new t.Vector3(0,1,0),$=new t.Vector3(0,0,1),J=new t.Vector3,ee=new t.Vector3,te=new t.Vector3;class ne extends t.Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new t.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=new t.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const o=n.clone();o.opacity=.5;const s=e.clone();s.color.setHex(16711680);const a=e.clone();a.color.setHex(65280);const r=e.clone();r.color.setHex(255);const c=e.clone();c.color.setHex(16711680),c.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const l=e.clone();l.color.setHex(255),l.opacity=.5;const d=e.clone();d.opacity=.25;const p=e.clone();p.color.setHex(16776960),p.opacity=.25;e.clone().color.setHex(16776960);const u=e.clone();u.color.setHex(7895160);const m=new t.CylinderGeometry(0,.04,.1,12);m.translate(0,.05,0);const w=new t.BoxGeometry(.08,.08,.08);w.translate(0,.04,0);const y=new t.BufferGeometry;y.setAttribute("position",new t.Float32BufferAttribute([0,0,0,1,0,0],3));const g=new t.CylinderGeometry(.0075,.0075,.5,3);function b(e,n){const i=new t.TorusGeometry(e,.0075,3,64,n*Math.PI*2);return i.rotateY(Math.PI/2),i.rotateX(Math.PI/2),i}g.translate(0,.25,0);const f={X:[[new t.Mesh(m,s),[.5,0,0],[0,0,-Math.PI/2]],[new t.Mesh(m,s),[-.5,0,0],[0,0,Math.PI/2]],[new t.Mesh(g,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new t.Mesh(m,a),[0,.5,0]],[new t.Mesh(m,a),[0,-.5,0],[Math.PI,0,0]],[new t.Mesh(g,a)]],Z:[[new t.Mesh(m,r),[0,0,.5],[Math.PI/2,0,0]],[new t.Mesh(m,r),[0,0,-.5],[-Math.PI/2,0,0]],[new t.Mesh(g,r),null,[Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.OctahedronGeometry(.1,0),d.clone()),[0,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),l.clone()),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),c.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},v={X:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),i),[0,.3,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.OctahedronGeometry(.2,0),i)]],XY:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},M={START:[[new t.Mesh(new t.OctahedronGeometry(.01,2),o),null,null,null,"helper"]],END:[[new t.Mesh(new t.OctahedronGeometry(.01,2),o),null,null,null,"helper"]],DELTA:[[new t.Line(function(){const e=new t.BufferGeometry;return e.setAttribute("position",new t.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),o),null,null,null,"helper"]],X:[[new t.Line(y,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new t.Line(y,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new t.Line(y,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},E={XYZE:[[new t.Mesh(b(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new t.Mesh(b(.5,.5),s)]],Y:[[new t.Mesh(b(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new t.Mesh(b(.5,.5),r),null,[0,Math.PI/2,0]]],E:[[new t.Mesh(b(.75,1),p),null,[0,Math.PI/2,0]]]},x={AXIS:[[new t.Line(y,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={XYZE:[[new t.Mesh(new t.SphereGeometry(.25,10,8),i)]],X:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new t.Mesh(new t.TorusGeometry(.75,.1,2,24),i)]]},C={X:[[new t.Mesh(w,s),[.5,0,0],[0,0,-Math.PI/2]],[new t.Mesh(g,s),[0,0,0],[0,0,-Math.PI/2]],[new t.Mesh(w,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(w,a),[0,.5,0]],[new t.Mesh(g,a)],[new t.Mesh(w,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new t.Mesh(w,r),[0,0,.5],[Math.PI/2,0,0]],[new t.Mesh(g,r),[0,0,0],[Math.PI/2,0,0]],[new t.Mesh(w,r),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),l),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.BoxGeometry(.1,.1,.1),d.clone())]]},_={X:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),i),[0,.3,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.2),i),[0,0,0]]]},S={X:[[new t.Line(y,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new t.Line(y,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new t.Line(y,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function O(e){const n=new t.Object3D;for(const t in e)for(let i=e[t].length;i--;){const o=e[t][i][0].clone(),s=e[t][i][1],a=e[t][i][2],r=e[t][i][3],c=e[t][i][4];o.name=t,o.tag=c,s&&o.position.set(s[0],s[1],s[2]),a&&o.rotation.set(a[0],a[1],a[2]),r&&o.scale.set(r[0],r[1],r[2]),o.updateMatrix();const h=o.geometry.clone();h.applyMatrix4(o.matrix),o.geometry=h,o.renderOrder=1/0,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),n.add(o)}return n}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=O(f)),this.add(this.gizmo.rotate=O(E)),this.add(this.gizmo.scale=O(C)),this.add(this.picker.translate=O(v)),this.add(this.picker.rotate=O(P)),this.add(this.picker.scale=O(_)),this.add(this.helper.translate=O(M)),this.add(this.helper.rotate=O(x)),this.add(this.helper.scale=O(S)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:U;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let e=0;e<n.length;e++){const i=n[e];let o;if(i.visible=!0,i.rotation.set(0,0,0),i.position.copy(this.worldPosition),o=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),i.scale.set(1,1,1).multiplyScalar(o*this.size/4),"helper"!==i.tag){if(i.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const e=.99,n=.2;"X"===i.name&&Math.abs(Q.copy(W).applyQuaternion(t).dot(this.eye))>e&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Y"===i.name&&Math.abs(Q.copy(K).applyQuaternion(t).dot(this.eye))>e&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Z"===i.name&&Math.abs(Q.copy($).applyQuaternion(t).dot(this.eye))>e&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XY"===i.name&&Math.abs(Q.copy($).applyQuaternion(t).dot(this.eye))<n&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"YZ"===i.name&&Math.abs(Q.copy(W).applyQuaternion(t).dot(this.eye))<n&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XZ"===i.name&&Math.abs(Q.copy(K).applyQuaternion(t).dot(this.eye))<n&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1)}else"rotate"===this.mode&&(N.copy(t),Q.copy(this.eye).applyQuaternion(j.copy(t).invert()),-1!==i.name.search("E")&&i.quaternion.setFromRotationMatrix(B.lookAt(this.eye,D,K)),"X"===i.name&&(j.setFromAxisAngle(W,Math.atan2(-Q.y,Q.z)),j.multiplyQuaternions(N,j),i.quaternion.copy(j)),"Y"===i.name&&(j.setFromAxisAngle(K,Math.atan2(Q.x,Q.z)),j.multiplyQuaternions(N,j),i.quaternion.copy(j)),"Z"===i.name&&(j.setFromAxisAngle($,Math.atan2(Q.y,Q.x)),j.multiplyQuaternions(N,j),i.quaternion.copy(j)));i.visible=i.visible&&(-1===i.name.indexOf("X")||this.showX),i.visible=i.visible&&(-1===i.name.indexOf("Y")||this.showY),i.visible=i.visible&&(-1===i.name.indexOf("Z")||this.showZ),i.visible=i.visible&&(-1===i.name.indexOf("E")||this.showX&&this.showY&&this.showZ),i.material._color=i.material._color||i.material.color.clone(),i.material._opacity=i.material._opacity||i.material.opacity,i.material.color.copy(i.material._color),i.material.opacity=i.material._opacity,this.enabled&&this.axis&&(i.name===this.axis||this.axis.split("").some((function(e){return i.name===e})))&&(i.material.color.setHex(16776960),i.material.opacity=1)}else i.visible=!1,"AXIS"===i.name?(i.visible=!!this.axis,"X"===this.axis&&(j.setFromEuler(Z.set(0,0,0)),i.quaternion.copy(t).multiply(j),Math.abs(Q.copy(W).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Y"===this.axis&&(j.setFromEuler(Z.set(0,0,Math.PI/2)),i.quaternion.copy(t).multiply(j),Math.abs(Q.copy(K).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Z"===this.axis&&(j.setFromEuler(Z.set(0,Math.PI/2,0)),i.quaternion.copy(t).multiply(j),Math.abs(Q.copy($).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"XYZE"===this.axis&&(j.setFromEuler(Z.set(0,Math.PI/2,0)),Q.copy(this.rotationAxis),i.quaternion.setFromRotationMatrix(B.lookAt(D,Q,K)),i.quaternion.multiply(j),i.visible=this.dragging),"E"===this.axis&&(i.visible=!1)):"START"===i.name?(i.position.copy(this.worldPositionStart),i.visible=this.dragging):"END"===i.name?(i.position.copy(this.worldPosition),i.visible=this.dragging):"DELTA"===i.name?(i.position.copy(this.worldPositionStart),i.quaternion.copy(this.worldQuaternionStart),S.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),S.applyQuaternion(this.worldQuaternionStart.clone().invert()),i.scale.copy(S),i.visible=this.dragging):(i.quaternion.copy(t),this.dragging?i.position.copy(this.worldPositionStart):i.position.copy(this.worldPosition),this.axis&&(i.visible=-1!==this.axis.search(i.name)))}super.updateMatrixWorld(e)}}class ie extends t.Mesh{constructor(){super(new t.PlaneGeometry(1e5,1e5,2,2),new t.MeshBasicMaterial({visible:!1,wireframe:!0,side:t.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),J.copy(W).applyQuaternion("local"===t?this.worldQuaternion:U),ee.copy(K).applyQuaternion("local"===t?this.worldQuaternion:U),te.copy($).applyQuaternion("local"===t?this.worldQuaternion:U),Q.copy(ee),this.mode){case"translate":case"scale":switch(this.axis){case"X":Q.copy(this.eye).cross(J),F.copy(J).cross(Q);break;case"Y":Q.copy(this.eye).cross(ee),F.copy(ee).cross(Q);break;case"Z":Q.copy(this.eye).cross(te),F.copy(te).cross(Q);break;case"XY":F.copy(te);break;case"YZ":F.copy(J);break;case"XZ":Q.copy(te),F.copy(ee);break;case"XYZ":case"E":F.set(0,0,0)}break;default:F.set(0,0,0)}0===F.length()?this.quaternion.copy(this.cameraQuaternion):(q.lookAt(S.set(0,0,0),F,Q),this.quaternion.setFromRotationMatrix(q)),super.updateMatrixWorld(e)}}class oe{constructor(e){this.enable=!0;const t=new b,n=new f,i=new f,o=new f,s=new f;t.add(n),t.add(new v),t.add(i),t.add(new v),t.add(o),t.add(new v),t.add(s),t.setStyle({bottom:"10px",left:"10px",position:"absolute"}),t.setId("Stats");const[a,r,c,h]=["objects : ","vertices : ","triangles : ","frameTime : "];function l(){const{scene:t}=e;let s=0,h=0,l=0;for(let e=0,n=t.children.length;e<n;e++){t.children[e].traverseVisible((e=>{if(s++,e?.isMesh||e?.isPoints){const{geometry:t}=e;h+=t.attributes.position.count,e.isMesh&&(null!==t.index?l+=t.index.count/3:l+=t.attributes.position.count/3)}}))}n.setTextContent(a+s),i.setTextContent(r+h),o.setTextContent(c+l)}n.setTextContent(`${a}0`),i.setTextContent(`${r}0`),o.setTextContent(`${c}0`),s.setTextContent(`${h}0 ms`),this.domElement=t.domElement,e.signals.sceneRendered.add((e=>{s.setTextContent(`${h+e.toFixed(2)} ms`)})),e.signals.objectAdded.add(l),e.signals.objectRemoved.add(l),this.show=function(){t.show()},this.hide=function(){t.hide()}}}return e.CoordinateHelper=p,e.CustomGridHelper=u,e.Editor=class extends n{constructor(e){super(),this.state={},this.signals={windowResize:new a,objectSelected:new a,intersectionsDetected:new a,objectAdded:new a,sceneGraphChanged:new a,viewPortCameraChanged:new a,sceneRendered:new a,transformModeChange:new a,objectRemoved:new a},this.target=e,this.container=new i(this),this.scene=d(),this.sceneHelper=d(),this.cameras={orthographic:l(),perspective:h()},this.viewPortCamera=this.cameras.orthographic,this.selector=new c(this),this.selected=[]}addObject(e,t,n){e.traverse((t=>{void 0!==t.geometry&&this.addGeometry(t.geometry),void 0!==t.material&&this.addMaterial(t.material),this.container.addObject(t),this.addCamera(e)})),void 0===t?this.scene.add(e):(void 0===n?t.add(e):t.children.slice(n,0,e),e.parent=t),this.signals.objectAdded.dispatch(e),this.signals.sceneGraphChanged.dispatch(),this.dispatchEvent("objectAdded",e)}addCamera(e){e?.isCamera&&this.container.addCamera(e)}removeCamera(e){e?.isCamera&&this.container.removeCamera(e)}addGeometry(e){this.container.addGeometry(e)}removeGeometry(e){this.container.removeGeometry(e)}addMaterial(e){this.container.addMaterial(e)}removeMaterial(e){this.container.removeMaterial(e)}removeObject(e){null!==e.parent&&(e.traverse((e=>{void 0!==e.geometry&&this.removeGeometry(e.geometry),void 0!==e.material&&this.removeMaterial(e.material),this.container.removeObject(e),this.removeCamera(e)})),e.parent.remove(e),this.signals.objectRemoved.dispatch(e),this.signals.sceneGraphChanged.dispatch())}removeObjectByUuid(e){const t=this.getObjectByUuid(e,!0);t&&this.removeObject(t)}getObjectByUuid(e,t=!1){return t?this.scene.getObjectByProperty("uuid",e):this.container.getObjectByUuid(e)}getObjectsByProperty(e,t){let n=this.scene.getObjectsByProperty(e,t);const i=this.sceneHelper.getObjectsByProperty(e,t);return i.length>0&&(n=n.concat(i)),n}toggleViewportCamera(){const{orthographic:e,perspective:t}=this.cameras;e===this.viewPortCamera?this.viewPortCamera=t:this.viewPortCamera=e,this.signals.viewPortCameraChanged.dispatch(),this.signals.sceneGraphChanged.dispatch()}setState(e,t){this.state[e]=t}getState(e){return this.state[e]}select(e){void 0!==e?Array.isArray(e)?this.selector.select(e.map((e=>e?.uuid))):this.selector.select([e?.uuid]):this.selector.detach()}selectById(e){void 0!==e?Array.isArray(e)?this.selector.select(e):this.selector.select([e]):this.selector.detach()}setSceneBackground(e){this.scene.background=e,this.signals.sceneGraphChanged.dispatch()}},e.ViewHelper=M,e.ViewPort=class{constructor(e){const{signals:n}=e,i=function(e={}){const n=new t.WebGLRenderer({antialias:!0,...e});return n.shadowMap.enabled=!0,n.shadowMapSoft=!0,n.shadowMap.type=t.PCFSoftShadowMap,n.setClearColor(11184810),n}();i.setAnimationLoop((function(){const e=A.getDelta();!0===d.animating&&(d.update(e),l=!0);!0===l&&y()}));const{scene:o}=e,{sceneHelper:s}=e,{target:a}=e;a.append(i.domElement);const r=new t.GridHelper(50,50,8947848);r.rotateX(Math.PI/2),r.isHelper=!0;const c=new R(e.viewPortCamera,a);c.addEventListener("change",(function(){const{object:e}=c;void 0!==e&&(p.setFromObject(e,!0),y())})),c.addEventListener("mouseDown",(function(){const{object:e}=c;void 0!==e&&(b=e.position.clone(),f=e.rotation.clone(),v=e.scale.clone(),h.enabled=!1)})),c.addEventListener("mouseUp",(function(){const{object:e}=c;if(void 0!==e){switch(c.getMode){case"translate":b.equals(e.position);break;case"rotate":f.equals(e.rotation);break;case"scale":v.equals(e.scale)}h.enabled=!0}})),s.add(c);const h=new C(e.viewPortCamera,a);let l=!1;h.addEventListener("change",(()=>{l=!0}));const d=new M(e.viewPortCamera,a),p=new t.Box3,u=new t.Box3Helper(p);let m,w;function y(){console.count("onRender ->"),m=performance.now(),i.render(o,e.viewPortCamera),i.autoClear=!1,s.add(r),i.render(s,e.viewPortCamera),s.remove(r),d.render(i),i.autoClear=!0,l=!1,w=performance.now(),n.sceneRendered.dispatch(w-m)}function g(){const{width:t,height:n}=a.getBoundingClientRect(),o=e.viewPortCamera;i.setSize(t,n),"OrthographicCamera"===o.type?(o.top=n/t*15,o.bottom=n/t*-15):"PerspectiveCamera"===o.type&&(o.aspect=t/n),o.updateProjectionMatrix()}u.visible=!1,u.material.transparent=!0,u.material.depthTest=!1,s.add(u),this.stats=new oe(e),a.append(this.stats.domElement);let b=null,f=null,v=null;const E=new t.Raycaster,x=new t.Vector2;function P(t){x.set(2*t.x-1,-2*t.y+1),E.setFromCamera(x,e.viewPortCamera);const n=[];o.traverseVisible((e=>{n.push(e)}));for(let e=0,t=s.children.length;e<t;e++){const t=s.children[e];t.uuid!==c.uuid&&t.uuid!==u.uuid&&t.visible&&n.push(s.children[e])}return E.intersectObjects(n,!1)}const _=new t.Vector2,S=new t.Vector2,O=new t.Vector2;function j(e,t){const{left:n,top:i,width:o,height:s}=a.getBoundingClientRect();return[(e-n)/o,(t-i)/s]}function T(e){const t=j(e.clientX,e.clientY);S.fromArray(t),function(){if(0===_.distanceTo(S)){const e=P(S);console.log(e,"handelClick");const t=e.map((e=>e?.object?.uuid)).filter((e=>void 0!==e));n.intersectionsDetected.dispatch(t)}}(),a.removeEventListener("mouseup",T)}a.addEventListener("mousedown",(function(e){const t=j(e.clientX,e.clientY);_.fromArray(t),a.addEventListener("mouseup",T)})),a.addEventListener("dblclick",(function(e){const t=j(e.clientX,e.clientY);O.fromArray(t),P(O).length}));const A=new t.Clock;n.windowResize.add((()=>{var e;e="editor resized",console.count(`info:${e}`),g(),y()})),n.windowResize.dispatch(),n.objectSelected.add((t=>{c.detach(),u.visible=!1;const n=e.getObjectByUuid(t[0]);!function(...e){console.log(...e)}("signals.objectSelected->",n),void 0!==n&&n!==o&&n!==e.viewPortCamera&&(p.setFromObject(n,!0),!1===p.isEmpty()&&(u.visible=!0),c.attach(n)),l=!0})),n.objectRemoved.add((t=>{const n=e.selected.findIndex((e=>e===t?.uuid));-1!==n&&e.selectById(e.selected.splice(n,1))})),n.sceneGraphChanged.add((()=>{y()})),n.viewPortCameraChanged.add((()=>{c.camera=e.viewPortCamera,h.object=e.viewPortCamera,d.object=e.viewPortCamera,e.viewPortCamera.lookAt(h.target),g()})),n.transformModeChange.add((e=>{c.setMode(e)})),this.setTransformMode=function(e){n.transformModeChange.dispatch(e)},this.transformControls=c}},e}({},THREE);
