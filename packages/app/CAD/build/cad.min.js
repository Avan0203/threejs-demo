var version=function(e,t){"use strict";function i(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var n=i(t);class s{constructor(){this.cameras={},this.lights={},this.objects={},this.geometries={},this.materials={},this.helpers={},this.groups={},this.textures={}}register(e){e?.isCamera?this.cameras[e.id]=e:e?.isLight?this.lights[e.id]=e:e?.isBufferGeometry?this.geometries[e.id]=e:e?.isMaterial?this.materials[e.id]=e:e?.isHelper?this.helpers[e.id]=e:e?.isTexture?this.textures[e.id]=e:e?.isGroup&&(this.groups[e.id]=e),this.objects[e.id]=e}discard(e){e?.isCamera?delete this.cameras[e.id]:e?.isLight?delete this.lights[e.id]:e?.isBufferGeometry?delete this.geometries[e.id]:e?.isMaterial?delete this.materials[e.id]:e?.isHelper?delete this.helpers[e.id]:e?.isTexture?delete this.textures[e.id]:e?.isGroup&&delete this.groups[e.id],delete this.objects[e.id]}}
/** @license
   * JS Signals <http://millermedeiros.github.com/js-signals/>
   * Released under the MIT license
   * Author: Miller Medeiros
   * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
   */function o(e,t,i,n,s){this._listener=t,this._isOnce=i,this.context=n,this._signal=e,this._priority=s||0}function r(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function a(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){a.prototype.dispatch.apply(e,arguments)}}function h(){return new t.Scene}o.prototype={active:!0,params:null,execute:function(e){var t,i;return this.active&&this._listener&&(i=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,i),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},a.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,i,n){var s,r=this._indexOfListener(e,i);if(-1!==r){if((s=this._bindings[r]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else s=new o(this,e,t,i,n),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var i,n=this._bindings.length;n--;)if((i=this._bindings[n])._listener===e&&i.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,i){return r(e,"add"),this._registerListener(e,!1,t,i)},addOnce:function(e,t,i){return r(e,"addOnce"),this._registerListener(e,!0,t,i)},remove:function(e,t){r(e,"remove");var i=this._indexOfListener(e,t);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,i=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=i),n){t=this._bindings.slice(),this._shouldPropagate=!0;do{n--}while(t[n]&&this._shouldPropagate&&!1!==t[n].execute(i))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};const c=new n.Vector4;class l extends n.Object3D{constructor(e,t){super(),this.isViewHelper=!0,this.editorCamera=e,this.animating=!1,this.controls=null;const i=new n.Color("#ff3653"),s=new n.Color("#8adb00"),o=new n.Color("#2c8fff"),r=[],a=new n.Raycaster,h=new n.Vector2,l=new n.Object3D,d=new n.OrthographicCamera(-2,2,2,-2,0,4);d.position.set(0,0,2);const p=new n.BoxGeometry(.8,.05,.05).translate(.4,0,0),u=new n.Mesh(p,A(i)),m=new n.Mesh(p,A(s)),w=new n.Mesh(p,A(o));m.rotation.z=Math.PI/2,w.rotation.y=-Math.PI/2,this.add(u),this.add(w),this.add(m);const f=new n.Sprite(L(i,"X"));f.userData.type="posX";const y=new n.Sprite(L(s,"Y"));y.userData.type="posY";const g=new n.Sprite(L(o,"Z"));g.userData.type="posZ";const b=new n.Sprite(L(i));b.userData.type="negX";const v=new n.Sprite(L(s));v.userData.type="negY";const E=new n.Sprite(L(o));E.userData.type="negZ",f.position.x=1,y.position.y=1,g.position.z=1,b.position.x=-1,b.scale.setScalar(.8),v.position.y=-1,v.scale.setScalar(.8),E.position.z=-1,E.scale.setScalar(.8),this.add(f),this.add(y),this.add(g),this.add(b),this.add(v),this.add(E),r.push(f),r.push(y),r.push(g),r.push(b),r.push(v),r.push(E);const M=new n.Vector3,x=128,P=2*Math.PI;this.render=function(e){this.quaternion.copy(this.editorCamera.quaternion).invert(),this.updateMatrixWorld(),M.set(0,0,1),M.applyQuaternion(this.editorCamera.quaternion),M.x>=0?(f.material.opacity=1,b.material.opacity=.5):(f.material.opacity=.5,b.material.opacity=1),M.y>=0?(y.material.opacity=1,v.material.opacity=.5):(y.material.opacity=.5,v.material.opacity=1),M.z>=0?(g.material.opacity=1,E.material.opacity=.5):(g.material.opacity=.5,E.material.opacity=1);const i=t.offsetWidth-x;e.clearDepth(),e.getViewport(c),e.setViewport(i,0,x,x),e.render(this,d),e.setViewport(c.x,c.y,c.z,c.w)};const S=new n.Vector3,_=new n.Quaternion,T=new n.Quaternion,C=new n.Quaternion;let O=0;function A(e){return new n.MeshBasicMaterial({color:e,toneMapped:!1})}function L(e,t=null){const i=document.createElement("canvas");i.width=64,i.height=64;const s=i.getContext("2d");s.beginPath(),s.arc(32,32,16,0,2*Math.PI),s.closePath(),s.fillStyle=e.getStyle(),s.fill(),null!==t&&(s.font="24px Arial",s.textAlign="center",s.fillStyle="#000000",s.fillText(t,32,41));const o=new n.CanvasTexture(i);return new n.SpriteMaterial({map:o,toneMapped:!1})}this.handleClick=function(e){if(!0===this.animating)return!1;const i=t.getBoundingClientRect(),s=i.left+(t.offsetWidth-x),o=i.top+(t.offsetHeight-x);h.x=(e.clientX-s)/(i.width-s)*2-1,h.y=-(e.clientY-o)/(i.bottom-o)*2+1,a.setFromCamera(h,d);const c=a.intersectObjects(r);if(c.length>0){return function(e,t){switch(e.userData.type){case"posX":S.set(1,0,0),_.setFromEuler(new n.Euler(0,.5*Math.PI,0));break;case"posY":S.set(0,1,0),_.setFromEuler(new n.Euler(.5*-Math.PI,0,0));break;case"posZ":S.set(0,0,1),_.setFromEuler(new n.Euler);break;case"negX":S.set(-1,0,0),_.setFromEuler(new n.Euler(0,.5*-Math.PI,0));break;case"negY":S.set(0,-1,0),_.setFromEuler(new n.Euler(.5*Math.PI,0,0));break;case"negZ":S.set(0,0,-1),_.setFromEuler(new n.Euler(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}O=this.editorCamera.position.distanceTo(t),S.multiplyScalar(O).add(t),l.position.copy(t),l.lookAt(this.editorCamera.position),T.copy(l.quaternion),l.lookAt(S),C.copy(l.quaternion)}(c[0].object,this.controls.center),this.animating=!0,!0}return!1},this.update=function(e){const t=e*P,i=this.controls.center;T.rotateTowards(C,t),this.editorCamera.position.set(0,0,1).applyQuaternion(T).multiplyScalar(O).add(i),this.editorCamera.quaternion.rotateTowards(_,t),0===T.angleTo(C)&&(this.animating=!1)},this.dispose=function(){p.dispose(),u.material.dispose(),m.material.dispose(),w.material.dispose(),f.material.map.dispose(),y.material.map.dispose(),g.material.map.dispose(),b.material.map.dispose(),v.material.map.dispose(),E.material.map.dispose(),f.material.dispose(),y.material.dispose(),g.material.dispose(),b.material.dispose(),v.material.dispose(),E.material.dispose()}}}const d={type:"change"},p={type:"start"},u={type:"end"};class m extends t.EventDispatcher{constructor(e,i){super(),void 0===i&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),i===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.zoomToCursor=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this.touches={ONE:t.TOUCH.ROTATE,TWO:t.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",q),this._domElementKeyEvents=e},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(d),n.update(),o=s.NONE},this.update=function(){const i=new t.Vector3,p=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),u=p.clone().invert(),w=new t.Vector3,f=new t.Quaternion,y=2*Math.PI;return function(){const e=n.object.position;i.copy(e).sub(n.target),i.applyQuaternion(p),a.setFromVector3(i),n.autoRotate&&o===s.NONE&&C(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(a.theta+=h.theta*n.dampingFactor,a.phi+=h.phi*n.dampingFactor):(a.theta+=h.theta,a.phi+=h.phi);let t=n.minAzimuthAngle,g=n.maxAzimuthAngle;return isFinite(t)&&isFinite(g)&&(t<-Math.PI?t+=y:t>Math.PI&&(t-=y),g<-Math.PI?g+=y:g>Math.PI&&(g-=y),a.theta=t<=g?Math.max(t,Math.min(g,a.theta)):a.theta>(t+g)/2?Math.max(t,a.theta):Math.min(g,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(n.minDistance,Math.min(n.maxDistance,a.radius)),1==_?n.target.add(l):!0===n.enableDamping?n.target.addScaledVector(l,n.dampingFactor):n.target.add(l),i.setFromSpherical(a),i.applyQuaternion(u),e.copy(n.target).add(i),n.object.lookAt(n.target),!0===_?(l.set(0,0,0),h.set(0,0,0),_=!1):!0===n.enableDamping?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor,l.multiplyScalar(1-n.dampingFactor)):(h.set(0,0,0),l.set(0,0,0)),c=1,!!(m||w.distanceToSquared(n.object.position)>r||8*(1-f.dot(n.object.quaternion))>r)&&(n.dispatchEvent(d),w.copy(n.object.position),f.copy(n.object.quaternion),m=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",W),n.domElement.removeEventListener("pointerdown",N),n.domElement.removeEventListener("pointercancel",F),n.domElement.removeEventListener("wheel",U),n.domElement.removeEventListener("pointermove",B),n.domElement.removeEventListener("pointerup",G),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",q)};const n=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=s.NONE;const r=1e-6,a=new t.Spherical,h=new t.Spherical;let c=1;const l=new t.Vector3;let m=!1;const w=new t.Vector2,f=new t.Vector2,y=new t.Vector2,g=new t.Vector2,b=new t.Vector2,v=new t.Vector2,E=new t.Vector2,M=new t.Vector2,x=new t.Vector2,P=[],S={};let _=!1;function T(){return Math.pow(.95,n.zoomSpeed)}function C(e){h.theta-=e}function O(e){h.phi-=e}const A=function(){const e=new t.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),l.add(e)}}(),L=function(){const e=new t.Vector3;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),l.add(e)}}(),I=function(){const e=new t.Vector3;return function(t,i){const s=n.domElement;if(n.object.isPerspectiveCamera){const o=n.object.position;e.copy(o).sub(n.target);let r=e.length();r*=Math.tan(n.object.fov/2*Math.PI/180),A(2*t*r/s.clientHeight,n.object.matrix),L(2*i*r/s.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(A(t*(n.object.right-n.object.left)/n.object.zoom/s.clientWidth,n.object.matrix),L(i*(n.object.top-n.object.bottom)/n.object.zoom/s.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function D(e){n.object.isPerspectiveCamera?c/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function R(e){console.log(e),n.object.isPerspectiveCamera?c*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Y(e){w.set(e.clientX,e.clientY)}function j(e){g.set(e.clientX,e.clientY)}function X(e){n.zoomToCursor?function(e){const i=e.offsetX/n.domElement.clientWidth*2-1,s=-e.offsetY/n.domElement.clientHeight*2+1,o=new t.Vector3(i,s,0);if(o.unproject(n.object),o.sub(n.object.position).setLength(10*n.zoomSpeed),n.object.isPerspectiveCamera)e.deltaY<0?(n.object.position.add(o),n.target.add(o)):(n.object.position.sub(o),n.target.sub(o));else if(n.object.isOrthographicCamera){const t=n.domElement,i=t.getBoundingClientRect(),s=.5*t.clientWidth,o=.5*t.clientHeight,r=(e.clientX-s-i.left)*(1-1/T()),a=(e.clientY-o-i.top)*(1-1/T());e.deltaY<0?(R(T()),I(r,a)):(D(T()),I(-r,-a)),_=!0}}(e):function(e){e.deltaY<0?R(T()):e.deltaY>0&&D(T())}(e),n.update()}function z(){if(1===P.length)w.set(P[0].pageX,P[0].pageY);else{const e=.5*(P[0].pageX+P[1].pageX),t=.5*(P[0].pageY+P[1].pageY);w.set(e,t)}}function Q(){if(1===P.length)g.set(P[0].pageX,P[0].pageY);else{const e=.5*(P[0].pageX+P[1].pageX),t=.5*(P[0].pageY+P[1].pageY);g.set(e,t)}}function V(){const e=P[0].pageX-P[1].pageX,t=P[0].pageY-P[1].pageY,i=Math.sqrt(e*e+t*t);E.set(0,i)}function k(e){if(1==P.length)f.set(e.pageX,e.pageY);else{const t=$(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);f.set(i,n)}y.subVectors(f,w).multiplyScalar(n.rotateSpeed);const t=n.domElement;C(2*Math.PI*y.x/t.clientHeight),O(2*Math.PI*y.y/t.clientHeight),w.copy(f)}function Z(e){if(1===P.length)b.set(e.pageX,e.pageY);else{const t=$(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);b.set(i,n)}v.subVectors(b,g).multiplyScalar(n.panSpeed),I(v.x,v.y),g.copy(b)}function H(e){const t=$(e),i=e.pageX-t.x,s=e.pageY-t.y,o=Math.sqrt(i*i+s*s);M.set(0,o),x.set(0,Math.pow(M.y/E.y,n.zoomSpeed)),D(x.y),E.copy(M)}function N(e){!1!==n.enabled&&(0===P.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",B),n.domElement.addEventListener("pointerup",G)),function(e){P.push(e)}(e),"touch"===e.pointerType?function(e){switch(J(e),P.length){case 1:switch(n.touches.ONE){case t.TOUCH.ROTATE:if(!1===n.enableRotate)return;z(),o=s.TOUCH_ROTATE;break;case t.TOUCH.PAN:if(!1===n.enablePan)return;Q(),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(n.touches.TWO){case t.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&V(),n.enablePan&&Q(),o=s.TOUCH_DOLLY_PAN;break;case t.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&V(),n.enableRotate&&z(),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(p)}(e):function(e){let i;switch(e.button){case 0:i=n.mouseButtons.LEFT;break;case 1:i=n.mouseButtons.MIDDLE;break;case 2:i=n.mouseButtons.RIGHT;break;default:i=-1}switch(i){case t.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(e){E.set(e.clientX,e.clientY)}(e),o=s.DOLLY;break;case t.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;j(e),o=s.PAN}else{if(!1===n.enableRotate)return;Y(e),o=s.ROTATE}break;case t.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;Y(e),o=s.ROTATE}else{if(!1===n.enablePan)return;j(e),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(p)}(e))}function B(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(J(e),o){case s.TOUCH_ROTATE:if(!1===n.enableRotate)return;k(e),n.update();break;case s.TOUCH_PAN:if(!1===n.enablePan)return;Z(e),n.update();break;case s.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&H(e),n.enablePan&&Z(e)}(e),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&H(e),n.enableRotate&&k(e)}(e),n.update();break;default:o=s.NONE}}(e):function(e){if(!1===n.enabled)return;switch(o){case s.ROTATE:if(!1===n.enableRotate)return;!function(e){f.set(e.clientX,e.clientY),y.subVectors(f,w).multiplyScalar(n.rotateSpeed);const t=n.domElement;C(2*Math.PI*y.x/t.clientHeight),O(2*Math.PI*y.y/t.clientHeight),w.copy(f),n.update()}(e);break;case s.DOLLY:if(!1===n.enableZoom)return;!function(e){M.set(e.clientX,e.clientY),x.subVectors(M,E),x.y>0?D(T()):x.y<0&&R(T()),E.copy(M),n.update()}(e);break;case s.PAN:if(!1===n.enablePan)return;!function(e){b.set(e.clientX,e.clientY),v.subVectors(b,g).multiplyScalar(n.panSpeed),I(v.x,v.y),g.copy(b),n.update()}(e)}}(e))}function G(e){K(e),0===P.length&&(n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",B),n.domElement.removeEventListener("pointerup",G)),n.dispatchEvent(u),o=s.NONE}function F(e){K(e)}function U(e){!1!==n.enabled&&!1!==n.enableZoom&&o===s.NONE&&(e.preventDefault(),n.dispatchEvent(p),X(e),n.dispatchEvent(u))}function q(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:I(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:I(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:I(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:I(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function W(e){!1!==n.enabled&&e.preventDefault()}function K(e){delete S[e.pointerId];for(let t=0;t<P.length;t++)if(P[t].pointerId==e.pointerId)return void P.splice(t,1)}function J(e){let i=S[e.pointerId];void 0===i&&(i=new t.Vector2,S[e.pointerId]=i),i.set(e.pageX,e.pageY)}function $(e){const t=e.pointerId===P[0].pointerId?P[1]:P[0];return S[t.pointerId]}n.domElement.addEventListener("contextmenu",W),n.domElement.addEventListener("pointerdown",N),n.domElement.addEventListener("pointercancel",F),n.domElement.addEventListener("wheel",U,{passive:!1}),this.update()}}const w=new t.Raycaster,f=new t.Vector3,y=new t.Vector3,g=new t.Quaternion,b={X:new t.Vector3(1,0,0),Y:new t.Vector3(0,1,0),Z:new t.Vector3(0,0,1)},v={type:"change"},E={type:"mouseDown"},M={type:"mouseUp",mode:null},x={type:"objectChange"};class P extends t.Object3D{constructor(e,i){super(),void 0===i&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const n=new B;this._gizmo=n,this.add(n);const s=new G;this._plane=s,this.add(s);const o=this;function r(e,t){let i=t;Object.defineProperty(o,e,{get:function(){return void 0!==i?i:t},set:function(t){i!==t&&(i=t,s[e]=t,n[e]=t,o.dispatchEvent({type:e+"-changed",value:t}),o.dispatchEvent(v))}}),o[e]=t,s[e]=t,n[e]=t}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const a=new t.Vector3,h=new t.Vector3,c=new t.Quaternion,l=new t.Quaternion,d=new t.Vector3,p=new t.Quaternion,u=new t.Vector3,m=new t.Vector3,w=new t.Vector3,f=new t.Vector3;r("worldPosition",a),r("worldPositionStart",h),r("worldQuaternion",c),r("worldQuaternionStart",l),r("cameraPosition",d),r("cameraQuaternion",p),r("pointStart",u),r("pointEnd",m),r("rotationAxis",w),r("rotationAngle",0),r("eye",f),this._offset=new t.Vector3,this._startNorm=new t.Vector3,this._endNorm=new t.Vector3,this._cameraScale=new t.Vector3,this._parentPosition=new t.Vector3,this._parentQuaternion=new t.Quaternion,this._parentQuaternionInv=new t.Quaternion,this._parentScale=new t.Vector3,this._worldScaleStart=new t.Vector3,this._worldQuaternionInv=new t.Quaternion,this._worldScale=new t.Vector3,this._positionStart=new t.Vector3,this._quaternionStart=new t.Quaternion,this._scaleStart=new t.Vector3,this._getPointer=S.bind(this),this._onPointerDown=T.bind(this),this._onPointerHover=_.bind(this),this._onPointerMove=C.bind(this),this._onPointerUp=O.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;w.setFromCamera(e,this.camera);const t=A(this._gizmo.picker[this.mode],w);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){w.setFromCamera(e,this.camera);const t=A(this._plane,w,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,E.mode=this.mode,this.dispatchEvent(E)}}pointerMove(e){const t=this.axis,i=this.mode,n=this.object;let s=this.space;if("scale"===i?s="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(s="world"),void 0===n||null===t||!1===this.dragging||-1!==e.button)return;w.setFromCamera(e,this.camera);const o=A(this._plane,w,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),"translate"===i)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===s&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===s&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===s&&(n.position.applyQuaternion(g.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),"world"===s&&(n.parent&&n.position.add(f.setFromMatrixPosition(n.parent.matrixWorld)),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(f.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===i){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),y.set(e,e,e)}else f.copy(this.pointStart),y.copy(this.pointEnd),f.applyQuaternion(this._worldQuaternionInv),y.applyQuaternion(this._worldQuaternionInv),y.divide(f),-1===t.search("X")&&(y.x=1),-1===t.search("Y")&&(y.y=1),-1===t.search("Z")&&(y.z=1);n.scale.copy(this._scaleStart).multiply(y),this.scaleSnap&&(-1!==t.search("X")&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===i){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(f.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(f.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(b[t]),f.copy(b[t]),"local"===s&&f.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(f.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===s&&"E"!==t&&"XYZE"!==t?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(g.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(g.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(v),this.dispatchEvent(x)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&(M.mode=this.mode,this.dispatchEvent(M)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(v),this.dispatchEvent(x),this.pointStart.copy(this.pointEnd))}getRaycaster(){return w}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function S(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function _(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function T(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function C(e){this.enabled&&this.pointerMove(this._getPointer(e))}function O(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function A(e,t,i){const n=t.intersectObject(e,!0);for(let e=0;e<n.length;e++)if(n[e].object.visible||i)return n[e];return!1}const L=new t.Euler,I=new t.Vector3(0,1,0),D=new t.Vector3(0,0,0),R=new t.Matrix4,Y=new t.Quaternion,j=new t.Quaternion,X=new t.Vector3,z=new t.Matrix4,Q=new t.Vector3(1,0,0),V=new t.Vector3(0,1,0),k=new t.Vector3(0,0,1),Z=new t.Vector3,H=new t.Vector3,N=new t.Vector3;class B extends t.Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new t.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new t.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const s=i.clone();s.opacity=.5;const o=e.clone();o.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const a=e.clone();a.color.setHex(255);const h=e.clone();h.color.setHex(16711680),h.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const l=e.clone();l.color.setHex(255),l.opacity=.5;const d=e.clone();d.opacity=.25;const p=e.clone();p.color.setHex(16776960),p.opacity=.25;e.clone().color.setHex(16776960);const u=e.clone();u.color.setHex(7895160);const m=new t.CylinderGeometry(0,.04,.1,12);m.translate(0,.05,0);const w=new t.BoxGeometry(.08,.08,.08);w.translate(0,.04,0);const f=new t.BufferGeometry;f.setAttribute("position",new t.Float32BufferAttribute([0,0,0,1,0,0],3));const y=new t.CylinderGeometry(.0075,.0075,.5,3);function g(e,i){const n=new t.TorusGeometry(e,.0075,3,64,i*Math.PI*2);return n.rotateY(Math.PI/2),n.rotateX(Math.PI/2),n}y.translate(0,.25,0);const b={X:[[new t.Mesh(m,o),[.5,0,0],[0,0,-Math.PI/2]],[new t.Mesh(m,o),[-.5,0,0],[0,0,Math.PI/2]],[new t.Mesh(y,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new t.Mesh(m,r),[0,.5,0]],[new t.Mesh(m,r),[0,-.5,0],[Math.PI,0,0]],[new t.Mesh(y,r)]],Z:[[new t.Mesh(m,a),[0,0,.5],[Math.PI/2,0,0]],[new t.Mesh(m,a),[0,0,-.5],[-Math.PI/2,0,0]],[new t.Mesh(y,a),null,[Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.OctahedronGeometry(.1,0),d.clone()),[0,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),l.clone()),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},v={X:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,.3,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.OctahedronGeometry(.2,0),n)]],XY:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},E={START:[[new t.Mesh(new t.OctahedronGeometry(.01,2),s),null,null,null,"helper"]],END:[[new t.Mesh(new t.OctahedronGeometry(.01,2),s),null,null,null,"helper"]],DELTA:[[new t.Line(function(){const e=new t.BufferGeometry;return e.setAttribute("position",new t.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),s),null,null,null,"helper"]],X:[[new t.Line(f,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new t.Line(f,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new t.Line(f,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new t.Mesh(g(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new t.Mesh(g(.5,.5),o)]],Y:[[new t.Mesh(g(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new t.Mesh(g(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new t.Mesh(g(.75,1),p),null,[0,Math.PI/2,0]]]},x={AXIS:[[new t.Line(f,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={XYZE:[[new t.Mesh(new t.SphereGeometry(.25,10,8),n)]],X:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new t.Mesh(new t.TorusGeometry(.75,.1,2,24),n)]]},S={X:[[new t.Mesh(w,o),[.5,0,0],[0,0,-Math.PI/2]],[new t.Mesh(y,o),[0,0,0],[0,0,-Math.PI/2]],[new t.Mesh(w,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(w,r),[0,.5,0]],[new t.Mesh(y,r)],[new t.Mesh(w,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new t.Mesh(w,a),[0,0,.5],[Math.PI/2,0,0]],[new t.Mesh(y,a),[0,0,0],[Math.PI/2,0,0]],[new t.Mesh(w,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),l),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.BoxGeometry(.1,.1,.1),d.clone())]]},_={X:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,.3,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.2),n),[0,0,0]]]},T={X:[[new t.Line(f,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new t.Line(f,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new t.Line(f,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function C(e){const i=new t.Object3D;for(const t in e)for(let n=e[t].length;n--;){const s=e[t][n][0].clone(),o=e[t][n][1],r=e[t][n][2],a=e[t][n][3],h=e[t][n][4];s.name=t,s.tag=h,o&&s.position.set(o[0],o[1],o[2]),r&&s.rotation.set(r[0],r[1],r[2]),a&&s.scale.set(a[0],a[1],a[2]),s.updateMatrix();const c=s.geometry.clone();c.applyMatrix4(s.matrix),s.geometry=c,s.renderOrder=1/0,s.position.set(0,0,0),s.rotation.set(0,0,0),s.scale.set(1,1,1),i.add(s)}return i}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=C(b)),this.add(this.gizmo.rotate=C(M)),this.add(this.gizmo.scale=C(S)),this.add(this.picker.translate=C(v)),this.add(this.picker.rotate=C(P)),this.add(this.picker.scale=C(_)),this.add(this.helper.translate=C(E)),this.add(this.helper.rotate=C(x)),this.add(this.helper.scale=C(T)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:j;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let e=0;e<i.length;e++){const n=i[e];let s;if(n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition),s=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(s*this.size/4),"helper"!==n.tag){if(n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const e=.99,i=.2;"X"===n.name&&Math.abs(I.copy(Q).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"===n.name&&Math.abs(I.copy(V).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"===n.name&&Math.abs(I.copy(k).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(I.copy(k).applyQuaternion(t).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(I.copy(Q).applyQuaternion(t).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(I.copy(V).applyQuaternion(t).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)}else"rotate"===this.mode&&(Y.copy(t),I.copy(this.eye).applyQuaternion(g.copy(t).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(R.lookAt(this.eye,D,V)),"X"===n.name&&(g.setFromAxisAngle(Q,Math.atan2(-I.y,I.z)),g.multiplyQuaternions(Y,g),n.quaternion.copy(g)),"Y"===n.name&&(g.setFromAxisAngle(V,Math.atan2(I.x,I.z)),g.multiplyQuaternions(Y,g),n.quaternion.copy(g)),"Z"===n.name&&(g.setFromAxisAngle(k,Math.atan2(I.y,I.x)),g.multiplyQuaternions(Y,g),n.quaternion.copy(g)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some((function(e){return n.name===e})))&&(n.material.color.setHex(16776960),n.material.opacity=1)}else n.visible=!1,"AXIS"===n.name?(n.visible=!!this.axis,"X"===this.axis&&(g.setFromEuler(L.set(0,0,0)),n.quaternion.copy(t).multiply(g),Math.abs(I.copy(Q).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(g.setFromEuler(L.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(g),Math.abs(I.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(g.setFromEuler(L.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(g),Math.abs(I.copy(k).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(g.setFromEuler(L.set(0,Math.PI/2,0)),I.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(R.lookAt(D,I,V)),n.quaternion.multiply(g),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),f.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),f.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(f),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}super.updateMatrixWorld(e)}}class G extends t.Mesh{constructor(){super(new t.PlaneGeometry(1e5,1e5,2,2),new t.MeshBasicMaterial({visible:!1,wireframe:!0,side:t.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),Z.copy(Q).applyQuaternion("local"===t?this.worldQuaternion:j),H.copy(V).applyQuaternion("local"===t?this.worldQuaternion:j),N.copy(k).applyQuaternion("local"===t?this.worldQuaternion:j),I.copy(H),this.mode){case"translate":case"scale":switch(this.axis){case"X":I.copy(this.eye).cross(Z),X.copy(Z).cross(I);break;case"Y":I.copy(this.eye).cross(H),X.copy(H).cross(I);break;case"Z":I.copy(this.eye).cross(N),X.copy(N).cross(I);break;case"XY":X.copy(N);break;case"YZ":X.copy(Z);break;case"XZ":I.copy(N),X.copy(H);break;case"XYZ":case"E":X.set(0,0,0)}break;default:X.set(0,0,0)}0===X.length()?this.quaternion.copy(this.cameraQuaternion):(z.lookAt(f.set(0,0,0),X,I),this.quaternion.setFromRotationMatrix(z)),super.updateMatrixWorld(e)}}var F=function(){var e=0,t=document.createElement("div");function i(e){return t.appendChild(e.dom),e}function n(i){for(var n=0;n<t.children.length;n++)t.children[n].style.display=n===i?"block":"none";e=i}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(i){i.preventDefault(),n(++e%t.children.length)}),!1);var s=(performance||Date).now(),o=s,r=0,a=i(new F.Panel("FPS","#0ff","#002")),h=i(new F.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=i(new F.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:t,addPanel:i,showPanel:n,begin:function(){s=(performance||Date).now()},end:function(){r++;var e=(performance||Date).now();if(h.update(e-s,200),e>o+1e3&&(a.update(1e3*r/(e-o),100),o=e,r=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:t,setMode:n}};F.Panel=function(e,t,i){var n=1/0,s=0,o=Math.round,r=o(window.devicePixelRatio||1),a=80*r,h=48*r,c=3*r,l=2*r,d=3*r,p=15*r,u=74*r,m=30*r,w=document.createElement("canvas");w.width=a,w.height=h,w.style.cssText="width:80px;height:48px";var f=w.getContext("2d");return f.font="bold "+9*r+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=i,f.fillRect(0,0,a,h),f.fillStyle=t,f.fillText(e,c,l),f.fillRect(d,p,u,m),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(d,p,u,m),{dom:w,update:function(h,y){n=Math.min(n,h),s=Math.max(s,h),f.fillStyle=i,f.globalAlpha=1,f.fillRect(0,0,a,p),f.fillStyle=t,f.fillText(o(h)+" "+e+" ("+o(n)+"-"+o(s)+")",c,l),f.drawImage(w,d+r,p,u-r,m,d,p,u-r,m),f.fillRect(d+u-r,p,r,m),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(d+u-r,p,r,o((1-h/y)*m))}}};class U extends F.Panel{constructor(e,t="GPU MS"){super(t,"#f90","#210");let i=!0,n=e.getExtension("EXT_disjoint_timer_query_webgl2");null===n&&(i=!1,n=e.getExtension("EXT_disjoint_timer_query"),null===n&&console.warn("GPUStatsPanel: disjoint_time_query extension not available.")),this.context=e,this.extension=n,this.maxTime=30,this.activeQueries=0,this.startQuery=function(){const e=this.context,t=this.extension;if(null===t)return;let n;i?(n=e.createQuery(),e.beginQuery(t.TIME_ELAPSED_EXT,n)):(n=t.createQueryEXT(),t.beginQueryEXT(t.TIME_ELAPSED_EXT,n)),this.activeQueries++;const s=()=>{let o,r,a;i?(o=e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE),r=e.getParameter(t.GPU_DISJOINT_EXT),a=e.getQueryParameter(n,e.QUERY_RESULT)):(o=t.getQueryObjectEXT(n,t.QUERY_RESULT_AVAILABLE_EXT),r=e.getParameter(t.GPU_DISJOINT_EXT),a=t.getQueryObjectEXT(n,t.QUERY_RESULT_EXT));const h=1e-6*a;o?(r||this.update(h,this.maxTime),this.activeQueries--):!1===e.isContextLost()&&requestAnimationFrame(s)};requestAnimationFrame(s)},this.endQuery=function(){const e=this.extension,t=this.context;null!==e&&(i?t.endQuery(e.TIME_ELAPSED_EXT):e.endQueryEXT(e.TIME_ELAPSED_EXT))}}}class q{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const W=new t.OrthographicCamera(-1,1,1,-1,0,1),K=new t.BufferGeometry;K.setAttribute("position",new t.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),K.setAttribute("uv",new t.Float32BufferAttribute([0,2,0,0,2,0],2));class J{constructor(e){this._mesh=new t.Mesh(K,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,W)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class $ extends q{constructor(e,i,n,s,o){super(),this.scene=e,this.camera=i,this.overrideMaterial=n,this.clearColor=s,this.clearAlpha=void 0!==o?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new t.Color}render(e,t,i){const n=e.autoClear;let s,o;e.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),s=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,s),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),e.autoClear=n}}const ee={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class te extends q{constructor(e,i){super(),this.textureID=void 0!==i?i:"tDiffuse",e instanceof t.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=t.UniformsUtils.clone(e.uniforms),this.material=new t.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new J(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class ie extends q{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const n=e.getContext(),s=e.state;let o,r;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(o=0,r=1):(o=1,r=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),s.buffers.stencil.setFunc(n.ALWAYS,o,4294967295),s.buffers.stencil.setClear(r),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(n.EQUAL,1,4294967295),s.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),s.buffers.stencil.setLocked(!0)}}class ne extends q{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class se{constructor(e,i){if(this.renderer=e,void 0===i){const n=e.getSize(new t.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(i=new t.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new te(ee),this.clock=new t.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let t=0,n=this.passes.length;t<n;t++){const n=this.passes[t];if(!1!==n.enabled){if(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),n.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),n.needsSwap){if(i){const t=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),i.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==ie&&(n instanceof ie?i=!0:n instanceof ne&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const i=this.renderer.getSize(new t.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(i,n),this.renderTarget2.setSize(i,n);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(i,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}const oe="default",re="move",ae="zoom-in",he="alias",ce={"3D":new t.Vector3(1e3,1e3,1e3),XY:new t.Vector3(0,0,1e3),XZ:new t.Vector3(0,1e3,0),YZ:new t.Vector3(1e3,0,0)},le=15;let de=null,pe=null,ue=null;class me{constructor(e,t,i){this.id=e,this.parentId=t,this.ancestorId=i}}class we{constructor(){this.scene=new t.Scene,this.textures=new Map,this.materials=new Map,this.geometries=new Map,this._exclusion=[],this.pool=[]}set exclusion(e){this._exclusion=e,this.textures.clear(),this.materials.clear(),this.geometries.clear(),this.pool.length=0,this.scene.children.forEach((e=>this.track(e,!0)))}track(e){this.scene.add(e),this._exclusion.includes(e.type)||this.pool.push(e)}collect(e){ue=e.id;if(0!==e.children.length?e.children.forEach((e=>{this.collect(e),pe=e.id})):pe=e?.parent?.id,void 0!==e.geometry&&this.geometries.set(new me(ue,pe,de),e.geometry),void 0!==e.material){const t=e.material;Array.isArray(t)?t.forEach((e=>{this.materials.set(new me(ue,pe,de),e),this.collectTexture(e)})):(this.materials.set(new me(ue,pe,de),t),this.collectTexture(t))}}collectTexture(e){const t=t=>this.materials.set(new me(e.id,pe,de),t);e.alphaMap&&t(e.alphaMap),e.aoMap&&t(e.aoMap),e.envMap&&t(e.envMap),e.lightMap&&t(e.lightMap),e.map&&t(e.map),e.specularMap&&t(e.specularMap)}release(e){this.scene.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach((e=>e.dispose())):e.material.dispose())}}const fe=new t.Raycaster,ye=[];class ge extends t.Group{constructor(e={x:"red",y:"green",z:"blue"},i=10,n=1,s=.5*n){super(),this.colors=e,this.axesLength=i,this.arrowsLength=n,this.arrowsWidth=s,this.type="CoordinateHelper";const o={x:[1,0,0],y:[0,1,0],z:[0,0,1]},r=new t.Vector3;["x","y","z"].forEach((a=>{const h=new t.ArrowHelper(new t.Vector3(...o[a]),r,i,e[a],n,s);h.renderOrder=1/0,this.add(h)}))}setLength(e=10,t=1,i=.5*t){this.traverse((n=>{n.setLength(e,t,i)}))}dispose(){this.traverse((e=>{e.dispose()}))}}class be extends t.LineSegments{constructor(e=10,i=10,n=1,s=1,o=11184810,r=14671839,a=15658734){super(new t.BufferGeometry,new t.LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="CustomGridHelper",this.centerColor=new t.Color(o),this.baseColor=new t.Color(r),this.divsionColor=new t.Color(a),this.width=e,this.height=i,this.divsion=n,this.splice=s,this.update()}update(){let e;e=1===this.splice?1:1/this.splice;const{centerColor:i,baseColor:n,divsionColor:s,width:o,height:r,splice:a,divsion:h}=this,[c,l]=[o/h*a,r/h*a],d=[],p=[];let u,m,w,f=0;function y(e,t,o,r,h){const c={x:(e,t)=>d.push(-t,e,0,t,e,0),y:(e,t)=>d.push(e,-t,0,e,t,0)};for(let l=0,d=-e;l<=o;l++,d+=r)c[h](d,e),m=l%a==0,w=l===t,u=s,w?u=i:m&&!w&&(u=n),u.toArray(p,f),f+=3,u.toArray(p,f),f+=3}y(o/2,c/2,c,e,"x"),y(r/2,l/2,l,e,"y"),this.geometry.setAttribute("position",new t.Float32BufferAttribute(d,3)),this.geometry.setAttribute("color",new t.Float32BufferAttribute(p,3)),this.geometry.attributes.position.needUpdate=!0,this.geometry.attributes.color.needUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}class ve extends n.EventDispatcher{constructor(e,t){super(),this.enabled=!0,this.center=new n.Vector3,this.panSpeed=.002,this.zoomSpeed=1,this.rotationSpeed=.005,this.maxZoom=1/0,this.minZoom=0;var i=this,s=new n.Vector3,o=new n.Vector3,r=new n.Box3,a={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},h=a.NONE,c=this.center,l=new n.Matrix3,d=new n.Vector2,p=new n.Vector2,u=new n.Spherical,m=new n.Sphere,w={type:"change"};this.focus=function(t){var n;r.setFromObject(t),!1===r.isEmpty()?(r.getCenter(c),n=r.getBoundingSphere(m).radius):(c.setFromMatrixPosition(t.matrixWorld),n=.1),o.set(0,0,1),o.applyQuaternion(e.quaternion),o.multiplyScalar(4*n),e.position.copy(c).add(o),i.dispatchEvent(w)},this.pan=function(t){var n=e.position.distanceTo(c);t.multiplyScalar(n*i.panSpeed),t.applyMatrix3(l.getNormalMatrix(e.matrix)),e.position.add(t),c.add(t),i.dispatchEvent(w)};const f=new n.Vector3;function y(e){if(!1!==i.enabled){switch(e.pointerType){case"mouse":case"pen":!function(e){0===e.button?h=a.ROTATE:1===e.button?h=a.ZOOM:2===e.button&&(h=a.PAN);p.set(e.clientX,e.clientY)}(e)}t.ownerDocument.addEventListener("pointermove",g),t.ownerDocument.addEventListener("pointerup",b)}}function g(e){if(!1!==i.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){d.set(e.clientX,e.clientY);var t=d.x-p.x,n=d.y-p.y;h===a.ROTATE?i.rotate(o.set(-t,-n,0)):h===a.ZOOM?i.zoom(o.set(0,0,n)):h===a.PAN&&i.pan(o.set(-t,n,0));p.set(e.clientX,e.clientY)}(e)}}function b(e){switch(e.pointerType){case"mouse":case"pen":v()}t.ownerDocument.removeEventListener("pointermove",g),t.ownerDocument.removeEventListener("pointerup",b)}function v(){h=a.NONE}function E(e){!1!==i.enabled&&(e.preventDefault(),i.zoom(o.set(0,0,e.deltaY>0?1:-1)))}function M(e){e.preventDefault()}this.zoom=function(t){console.log(t),"PerspectiveCamera"===e.type?f.copy(e.position).sub(i.center):"OrthographicCamera"===e.type&&(e.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,t.z>0?e.zoom*Math.pow(.95,i.zoomSpeed):e.zoom/Math.pow(.95,i.zoomSpeed))),e.updateProjectionMatrix()),i.dispatchEvent(w)},this.rotate=function(t){s.copy(e.position).sub(c),u.setFromVector3(s),u.theta+=t.x*i.rotationSpeed,u.phi+=t.y*i.rotationSpeed,u.makeSafe(),s.setFromSpherical(u),e.position.copy(c).add(s),e.lookAt(c),i.dispatchEvent(w)},this.dispose=function(){t.removeEventListener("contextmenu",M),t.removeEventListener("dblclick",v),t.removeEventListener("wheel",E),t.removeEventListener("pointerdown",y),t.removeEventListener("touchstart",_),t.removeEventListener("touchmove",T)},t.addEventListener("contextmenu",M),t.addEventListener("dblclick",v),t.addEventListener("wheel",E),t.addEventListener("pointerdown",y);var x=[new n.Vector3,new n.Vector3,new n.Vector3],P=[new n.Vector3,new n.Vector3,new n.Vector3],S=null;function _(e){if(!1!==i.enabled){switch(e.touches.length){case 1:x[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),x[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio);break;case 2:x[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),x[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio),S=x[0].distanceTo(x[1])}P[0].copy(x[0]),P[1].copy(x[1])}}function T(e){if(!1!==i.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:x[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),x[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),i.rotate(x[0].sub(r(x[0],P)).multiplyScalar(-1));break;case 2:x[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),x[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio);var t=x[0].distanceTo(x[1]);i.zoom(o.set(0,0,S-t)),S=t;var n=x[0].clone().sub(r(x[0],P)),s=x[1].clone().sub(r(x[1],P));n.x=-n.x,s.x=-s.x,i.pan(n.add(s))}P[0].copy(x[0]),P[1].copy(x[1])}function r(e,t){var i=t[0];for(var n of t)i.distanceTo(e)>n.distanceTo(e)&&(i=n);return i}}t.addEventListener("touchstart",_),t.addEventListener("touchmove",T)}}return e.CAD=class{constructor(e,i,n){this.height=n||window.innerHeight,this.width=i||window.innerWidth,this._container=e,e.style.position="absolute",this.collector=new we,this.renderer=new t.WebGLRenderer({antialias:!0}),this.renderer.setClearColor("#ffffff"),this.renderer.setSize(this.width,this.height),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.autoClear=!1;const s=le*(this.height/this.width);this.cameras={"3D":new t.OrthographicCamera(-le,le,s,-s,1,1e5),"2D":new t.OrthographicCamera(-le,le,s,-s,1,1e5)},this.mainCamera=this.cameras["3D"],this.cameras["3D"].up.set(0,0,1),this.cameras["3D"].position.copy(ce["3D"]),this.cameras["3D"].name="3D",this.deputyCamera=this.cameras["2D"],this.cameras["2D"].up.set(0,0,1),this.cameras["2D"].position.copy(ce.XY),this.cameras["2D"].name="2D",this.orbitControls=new m(this.mainCamera,this.renderer.domElement),this.trasnlater=new P(this.mainCamera,this.renderer.domElement),this.viewHelper=new l(this.mainCamera,this.renderer.domElement),this.viewHelper.position.set(.5,.5,0),this.stats=new F,this.stats.dom.style.position="absolute",this.gpuPanel=new U(this.renderer.getContext()),this.stats.addPanel(this.gpuPanel),this.stats.showPanel(0),this.userData={},this.mainView="3D",e.appendChild(this.stats.dom),e.appendChild(this.renderer.domElement),this.composer=new se(this.renderer),this.renderPass=new $(this.collector.scene,this.mainCamera),this.composer.addPass(this.renderPass),this.mode="SELECT",this.setMode(this.mode),this.listenerControl(),this.selectChange=()=>{}}add(e){this.collector.track(e)}remove(e){this.collector.release(e)}removeById(e){this.remove(this.collector.scene.getObjectById(e))}setView(e){this.mainView=e,"3D"===e?(this.mainCamera=this.cameras["3D"],this.deputyCamera=this.cameras["2D"]):(this.mainCamera=this.cameras["2D"],this.mainCamera.position.copy(ce[e]),this.deputyCamera=this.cameras["3D"],this.mainCamera.updateProjectionMatrix()),this.renderPass.camera=this.viewHelper.editorCamera=this.orbitControls.object=this.mainCamera}setMode(e){this.mode=e,"SELECT"===e?(this.orbitControls.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this._container.style.cursor=oe):"ZOOM"===e?(this.orbitControls.mouseButtons={LEFT:t.MOUSE.DOLLY,MIDDLE:t.MOUSE.PAN,RIGHT:t.MOUSE.ROTATE},this._container.style.cursor=ae):"PAN"===e?(this.orbitControls.mouseButtons={LEFT:t.MOUSE.PAN,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.ROTATE},this._container.style.cursor=re):"ROTATE"===e&&(this.orbitControls.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.PAN,RIGHT:-1},this._container.style.cursor=he)}render(){requestAnimationFrame((()=>this.render())),this.gpuPanel.startQuery(),this.renderer.clear(),this.composer.render(),this.orbitControls.update(),this.viewHelper.render(this.renderer),this.stats.update(),this.gpuPanel.endQuery()}resize(e,t){this.width=e,this.height=t,this.renderer.setSize(this.width,this.height);const i=le*t/e;Object.values(this.cameras).forEach((e=>{e.top=i,e.bottom=-i,e.updateProjectionMatrix()}))}listenerControl(){const e=new t.Vector2;this.renderer.domElement.addEventListener("click",(t=>{e.x=t.clientX/this.width*2-1,e.y=-t.clientY/this.height*2+1,fe.setFromCamera(e,this.mainCamera),ye.length=[],fe.intersectObjects(this.collector.pool,!0,ye),this.selectChange(ye)}))}},e.Collector=we,e.Container=s,e.Control=class{constructor(e){this.orbitControls=new m(e.camera,e.target),this.tranformControls=new P(e.camera,e.target),this.orbitControls.addEventListener("change",(()=>{e.render()}))}},e.CoordinateHelper=ge,e.CustomGridHelper=be,e.Editor=class{constructor(e){this.state={},this.signals={rendererCreate:new a},this.target=e,this.container=new s,this.scene=h(),this.sceneHelper=h(),this.camera=function(e){const i=new t.PerspectiveCamera(50,1,.01,1e3),n=void 0!==e?e:new t.Vector3(0,5,10);return i.position.copy(n),i.name="default_perspective_camera",i.lookAt(new t.Vector3),i}()}addObject(e,t,i){this.container.register(e),this.scene.add(e)}removeObject(e){this.container.discard(e),this.scene.remove(e)}getObjectById(e){this.container.findById(e)}setSize(e,t){this.renderer.setSize(e,t)}},e.ViewHelper=l,e.ViewPort=class{constructor(e){e.signal;const i=function(e={}){const i=new t.WebGLRenderer(Object.assign({antialias:!0},e));return i.shadowMap.enabled=!0,i.shadowMapSoft=!0,i.shadowMap.type=t.PCFSoftShadowMap,i.setClearColor(11184810),i}(),n=e.camera,s=e.scene,o=e.sceneHelper,r=e.target;r.append(i.domElement);const a=new t.GridHelper(50,50,8947848);a.isHelper=!0;const h=new l(n,r);o.add(a),new t.Clock;new ve(n,r).addEventListener("change",(function(){c()}));const c=()=>{performance.now(),i.render(s,n),i.autoClear=!1,i.render(o,n),h.render(i),i.autoClear=!0,performance.now()};(()=>{const{width:e,height:t}=r.getBoundingClientRect();i.setSize(e,t),"OrthographicCamera"===n.type?(n.top=t/e*15,n.bottom=t/e*-15):"PerspectiveCamera"===n.type&&(n.aspect=e/t),n.updateProjectionMatrix()})(),c()}},e}({},THREE);
