var version=function(e,t){"use strict";function i(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var s=i(t);class n{constructor(){this.cameras={},this.lights={},this.objects={},this.geometries={},this.materials={},this.helpers={},this.groups={},this.textures={}}register(e){e?.isCamera?this.cameras[e.id]=e:e?.isLight?this.lights[e.id]=e:e?.isBufferGeometry?this.geometries[e.id]=e:e?.isMaterial?this.materials[e.id]=e:e?.isHelper?this.helpers[e.id]=e:e?.isTexture?this.textures[e.id]=e:e?.isGroup&&(this.groups[e.id]=e),this.objects[e.id]=e}discard(e){e?.isCamera?delete this.cameras[e.id]:e?.isLight?delete this.lights[e.id]:e?.isBufferGeometry?delete this.geometries[e.id]:e?.isMaterial?delete this.materials[e.id]:e?.isHelper?delete this.helpers[e.id]:e?.isTexture?delete this.textures[e.id]:e?.isGroup&&delete this.groups[e.id],delete this.objects[e.id]}}const o=new t.PerspectiveCamera(50,1,.01,1e3);o.position.set(0,5,10),o.name="default_perspective_camera",o.lookAt(new t.Vector3);class r extends t.Group{constructor(e={x:"red",y:"green",z:"blue"},i=10,s=1,n=.5*s){super(),this.colors=e,this.axesLength=i,this.arrowsLength=s,this.arrowsWidth=n,this.type="CoordinateHelper";const o={x:[1,0,0],y:[0,1,0],z:[0,0,1]},r=new t.Vector3;["x","y","z"].forEach((a=>{const h=new t.ArrowHelper(new t.Vector3(...o[a]),r,i,e[a],s,n);h.renderOrder=1/0,this.add(h)}))}setLength(e=10,t=1,i=.5*t){this.traverse((s=>{s.setLength(e,t,i)}))}dispose(){this.traverse((e=>{e.dispose()}))}}class a extends t.LineSegments{constructor(e=10,i=10,s=1,n=1,o=11184810,r=14671839,a=15658734){super(new t.BufferGeometry,new t.LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="CustomGridHelper",this.centerColor=new t.Color(o),this.baseColor=new t.Color(r),this.divsionColor=new t.Color(a),this.width=e,this.height=i,this.divsion=s,this.splice=n,this.update()}update(){let e;e=1===this.splice?1:1/this.splice;const{centerColor:i,baseColor:s,divsionColor:n,width:o,height:r,splice:a,divsion:h}=this,[l,c]=[o/h*a,r/h*a],d=[],p=[];let m,u,w,y=0;function f(e,t,o,r,h){const l={x:(e,t)=>d.push(-t,e,0,t,e,0),y:(e,t)=>d.push(e,-t,0,e,t,0)};for(let c=0,d=-e;c<=o;c++,d+=r)l[h](d,e),u=c%a==0,w=c===t,m=n,w?m=i:u&&!w&&(m=s),m.toArray(p,y),y+=3,m.toArray(p,y),y+=3}f(o/2,l/2,l,e,"x"),f(r/2,c/2,c,e,"y"),this.geometry.setAttribute("position",new t.Float32BufferAttribute(d,3)),this.geometry.setAttribute("color",new t.Float32BufferAttribute(p,3)),this.geometry.attributes.position.needUpdate=!0,this.geometry.attributes.color.needUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}const h=new s.Vector4;class l extends s.Object3D{constructor(e,t){super(),this.isViewHelper=!0,this.editorCamera=e,this.animating=!1,this.controls=null;const i=new s.Color("#ff3653"),n=new s.Color("#8adb00"),o=new s.Color("#2c8fff"),r=[],a=new s.Raycaster,l=new s.Vector2,c=new s.Object3D,d=new s.OrthographicCamera(-2,2,2,-2,0,4);d.position.set(0,0,2);const p=new s.BoxGeometry(.8,.05,.05).translate(.4,0,0),m=new s.Mesh(p,O(i)),u=new s.Mesh(p,O(n)),w=new s.Mesh(p,O(o));u.rotation.z=Math.PI/2,w.rotation.y=-Math.PI/2,this.add(m),this.add(w),this.add(u);const y=new s.Sprite(I(i,"X"));y.userData.type="posX";const f=new s.Sprite(I(n,"Y"));f.userData.type="posY";const g=new s.Sprite(I(o,"Z"));g.userData.type="posZ";const b=new s.Sprite(I(i));b.userData.type="negX";const E=new s.Sprite(I(n));E.userData.type="negY";const M=new s.Sprite(I(o));M.userData.type="negZ",y.position.x=1,f.position.y=1,g.position.z=1,b.position.x=-1,b.scale.setScalar(.8),E.position.y=-1,E.scale.setScalar(.8),M.position.z=-1,M.scale.setScalar(.8),this.add(y),this.add(f),this.add(g),this.add(b),this.add(E),this.add(M),r.push(y),r.push(f),r.push(g),r.push(b),r.push(E),r.push(M);const v=new s.Vector3,x=128,P=2*Math.PI;this.render=function(e){this.quaternion.copy(this.editorCamera.quaternion).invert(),this.updateMatrixWorld(),v.set(0,0,1),v.applyQuaternion(this.editorCamera.quaternion),v.x>=0?(y.material.opacity=1,b.material.opacity=.5):(y.material.opacity=.5,b.material.opacity=1),v.y>=0?(f.material.opacity=1,E.material.opacity=.5):(f.material.opacity=.5,E.material.opacity=1),v.z>=0?(g.material.opacity=1,M.material.opacity=.5):(g.material.opacity=.5,M.material.opacity=1);const i=t.offsetWidth-x;e.clearDepth(),e.getViewport(h),e.setViewport(i,0,x,x),e.render(this,d),e.setViewport(h.x,h.y,h.z,h.w)};const S=new s.Vector3,_=new s.Quaternion,T=new s.Quaternion,C=new s.Quaternion;let A=0;function O(e){return new s.MeshBasicMaterial({color:e,toneMapped:!1})}function I(e,t=null){const i=document.createElement("canvas");i.width=64,i.height=64;const n=i.getContext("2d");n.beginPath(),n.arc(32,32,16,0,2*Math.PI),n.closePath(),n.fillStyle=e.getStyle(),n.fill(),null!==t&&(n.font="24px Arial",n.textAlign="center",n.fillStyle="#000000",n.fillText(t,32,41));const o=new s.CanvasTexture(i);return new s.SpriteMaterial({map:o,toneMapped:!1})}this.handleClick=function(e){if(!0===this.animating)return!1;const i=t.getBoundingClientRect(),n=i.left+(t.offsetWidth-x),o=i.top+(t.offsetHeight-x);l.x=(e.clientX-n)/(i.width-n)*2-1,l.y=-(e.clientY-o)/(i.bottom-o)*2+1,a.setFromCamera(l,d);const h=a.intersectObjects(r);if(h.length>0){return function(e,t){switch(e.userData.type){case"posX":S.set(1,0,0),_.setFromEuler(new s.Euler(0,.5*Math.PI,0));break;case"posY":S.set(0,1,0),_.setFromEuler(new s.Euler(.5*-Math.PI,0,0));break;case"posZ":S.set(0,0,1),_.setFromEuler(new s.Euler);break;case"negX":S.set(-1,0,0),_.setFromEuler(new s.Euler(0,.5*-Math.PI,0));break;case"negY":S.set(0,-1,0),_.setFromEuler(new s.Euler(.5*Math.PI,0,0));break;case"negZ":S.set(0,0,-1),_.setFromEuler(new s.Euler(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}A=this.editorCamera.position.distanceTo(t),S.multiplyScalar(A).add(t),c.position.copy(t),c.lookAt(this.editorCamera.position),T.copy(c.quaternion),c.lookAt(S),C.copy(c.quaternion)}(h[0].object,this.controls.center),this.animating=!0,!0}return!1},this.update=function(e){const t=e*P,i=this.controls.center;T.rotateTowards(C,t),this.editorCamera.position.set(0,0,1).applyQuaternion(T).multiplyScalar(A).add(i),this.editorCamera.quaternion.rotateTowards(_,t),0===T.angleTo(C)&&(this.animating=!1)},this.dispose=function(){p.dispose(),m.material.dispose(),u.material.dispose(),w.material.dispose(),y.material.map.dispose(),f.material.map.dispose(),g.material.map.dispose(),b.material.map.dispose(),E.material.map.dispose(),M.material.map.dispose(),y.material.dispose(),f.material.dispose(),g.material.dispose(),b.material.dispose(),E.material.dispose(),M.material.dispose()}}}const c={type:"change"},d={type:"start"},p={type:"end"};class m extends t.EventDispatcher{constructor(e,i){super(),void 0===i&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),i===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.zoomToCursor=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this.touches={ONE:t.TOUCH.ROTATE,TWO:t.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",q),this._domElementKeyEvents=e},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(c),s.update(),o=n.NONE},this.update=function(){const i=new t.Vector3,d=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),p=d.clone().invert(),w=new t.Vector3,y=new t.Quaternion,f=2*Math.PI;return function(){const e=s.object.position;i.copy(e).sub(s.target),i.applyQuaternion(d),a.setFromVector3(i),s.autoRotate&&o===n.NONE&&C(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(a.theta+=h.theta*s.dampingFactor,a.phi+=h.phi*s.dampingFactor):(a.theta+=h.theta,a.phi+=h.phi);let t=s.minAzimuthAngle,g=s.maxAzimuthAngle;return isFinite(t)&&isFinite(g)&&(t<-Math.PI?t+=f:t>Math.PI&&(t-=f),g<-Math.PI?g+=f:g>Math.PI&&(g-=f),a.theta=t<=g?Math.max(t,Math.min(g,a.theta)):a.theta>(t+g)/2?Math.max(t,a.theta):Math.min(g,a.theta)),a.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=l,a.radius=Math.max(s.minDistance,Math.min(s.maxDistance,a.radius)),1==_?s.target.add(m):!0===s.enableDamping?s.target.addScaledVector(m,s.dampingFactor):s.target.add(m),i.setFromSpherical(a),i.applyQuaternion(p),e.copy(s.target).add(i),s.object.lookAt(s.target),!0===_?(m.set(0,0,0),h.set(0,0,0),_=!1):!0===s.enableDamping?(h.theta*=1-s.dampingFactor,h.phi*=1-s.dampingFactor,m.multiplyScalar(1-s.dampingFactor)):(h.set(0,0,0),m.set(0,0,0)),l=1,!!(u||w.distanceToSquared(s.object.position)>r||8*(1-y.dot(s.object.quaternion))>r)&&(s.dispatchEvent(c),w.copy(s.object.position),y.copy(s.object.quaternion),u=!1,!0)}}(),this.dispose=function(){s.domElement.removeEventListener("contextmenu",W),s.domElement.removeEventListener("pointerdown",G),s.domElement.removeEventListener("pointercancel",N),s.domElement.removeEventListener("wheel",F),s.domElement.removeEventListener("pointermove",B),s.domElement.removeEventListener("pointerup",U),null!==s._domElementKeyEvents&&s._domElementKeyEvents.removeEventListener("keydown",q)};const s=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=n.NONE;const r=1e-6,a=new t.Spherical,h=new t.Spherical;let l=1;const m=new t.Vector3;let u=!1;const w=new t.Vector2,y=new t.Vector2,f=new t.Vector2,g=new t.Vector2,b=new t.Vector2,E=new t.Vector2,M=new t.Vector2,v=new t.Vector2,x=new t.Vector2,P=[],S={};let _=!1;function T(){return Math.pow(.95,s.zoomSpeed)}function C(e){h.theta-=e}function A(e){h.phi-=e}const O=function(){const e=new t.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),m.add(e)}}(),I=function(){const e=new t.Vector3;return function(t,i){!0===s.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),m.add(e)}}(),L=function(){const e=new t.Vector3;return function(t,i){const n=s.domElement;if(s.object.isPerspectiveCamera){const o=s.object.position;e.copy(o).sub(s.target);let r=e.length();r*=Math.tan(s.object.fov/2*Math.PI/180),O(2*t*r/n.clientHeight,s.object.matrix),I(2*i*r/n.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(O(t*(s.object.right-s.object.left)/s.object.zoom/n.clientWidth,s.object.matrix),I(i*(s.object.top-s.object.bottom)/s.object.zoom/n.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function D(e){s.object.isPerspectiveCamera?l/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function R(e){s.object.isPerspectiveCamera?l*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function j(e){w.set(e.clientX,e.clientY)}function Y(e){g.set(e.clientX,e.clientY)}function Q(e){s.zoomToCursor?function(e){const i=e.offsetX/s.domElement.clientWidth*2-1,n=-e.offsetY/s.domElement.clientHeight*2+1,o=new t.Vector3(i,n,0);if(o.unproject(s.object),o.sub(s.object.position).setLength(10*s.zoomSpeed),s.object.isPerspectiveCamera)e.deltaY<0?(s.object.position.add(o),s.target.add(o)):(s.object.position.sub(o),s.target.sub(o));else if(s.object.isOrthographicCamera){const t=s.domElement,i=t.getBoundingClientRect(),n=.5*t.clientWidth,o=.5*t.clientHeight,r=(e.clientX-n-i.left)*(1-1/T()),a=(e.clientY-o-i.top)*(1-1/T());e.deltaY<0?(R(T()),L(r,a)):(D(T()),L(-r,-a)),_=!0}}(e):function(e){e.deltaY<0?R(T()):e.deltaY>0&&D(T())}(e),s.update()}function X(){if(1===P.length)w.set(P[0].pageX,P[0].pageY);else{const e=.5*(P[0].pageX+P[1].pageX),t=.5*(P[0].pageY+P[1].pageY);w.set(e,t)}}function k(){if(1===P.length)g.set(P[0].pageX,P[0].pageY);else{const e=.5*(P[0].pageX+P[1].pageX),t=.5*(P[0].pageY+P[1].pageY);g.set(e,t)}}function z(){const e=P[0].pageX-P[1].pageX,t=P[0].pageY-P[1].pageY,i=Math.sqrt(e*e+t*t);M.set(0,i)}function V(e){if(1==P.length)y.set(e.pageX,e.pageY);else{const t=$(e),i=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);y.set(i,s)}f.subVectors(y,w).multiplyScalar(s.rotateSpeed);const t=s.domElement;C(2*Math.PI*f.x/t.clientHeight),A(2*Math.PI*f.y/t.clientHeight),w.copy(y)}function Z(e){if(1===P.length)b.set(e.pageX,e.pageY);else{const t=$(e),i=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);b.set(i,s)}E.subVectors(b,g).multiplyScalar(s.panSpeed),L(E.x,E.y),g.copy(b)}function H(e){const t=$(e),i=e.pageX-t.x,n=e.pageY-t.y,o=Math.sqrt(i*i+n*n);v.set(0,o),x.set(0,Math.pow(v.y/M.y,s.zoomSpeed)),D(x.y),M.copy(v)}function G(e){!1!==s.enabled&&(0===P.length&&(s.domElement.setPointerCapture(e.pointerId),s.domElement.addEventListener("pointermove",B),s.domElement.addEventListener("pointerup",U)),function(e){P.push(e)}(e),"touch"===e.pointerType?function(e){switch(J(e),P.length){case 1:switch(s.touches.ONE){case t.TOUCH.ROTATE:if(!1===s.enableRotate)return;X(),o=n.TOUCH_ROTATE;break;case t.TOUCH.PAN:if(!1===s.enablePan)return;k(),o=n.TOUCH_PAN;break;default:o=n.NONE}break;case 2:switch(s.touches.TWO){case t.TOUCH.DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;s.enableZoom&&z(),s.enablePan&&k(),o=n.TOUCH_DOLLY_PAN;break;case t.TOUCH.DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;s.enableZoom&&z(),s.enableRotate&&X(),o=n.TOUCH_DOLLY_ROTATE;break;default:o=n.NONE}break;default:o=n.NONE}o!==n.NONE&&s.dispatchEvent(d)}(e):function(e){let i;switch(e.button){case 0:i=s.mouseButtons.LEFT;break;case 1:i=s.mouseButtons.MIDDLE;break;case 2:i=s.mouseButtons.RIGHT;break;default:i=-1}switch(i){case t.MOUSE.DOLLY:if(!1===s.enableZoom)return;!function(e){M.set(e.clientX,e.clientY)}(e),o=n.DOLLY;break;case t.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;Y(e),o=n.PAN}else{if(!1===s.enableRotate)return;j(e),o=n.ROTATE}break;case t.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enableRotate)return;j(e),o=n.ROTATE}else{if(!1===s.enablePan)return;Y(e),o=n.PAN}break;default:o=n.NONE}o!==n.NONE&&s.dispatchEvent(d)}(e))}function B(e){!1!==s.enabled&&("touch"===e.pointerType?function(e){switch(J(e),o){case n.TOUCH_ROTATE:if(!1===s.enableRotate)return;V(e),s.update();break;case n.TOUCH_PAN:if(!1===s.enablePan)return;Z(e),s.update();break;case n.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){s.enableZoom&&H(e),s.enablePan&&Z(e)}(e),s.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(e){s.enableZoom&&H(e),s.enableRotate&&V(e)}(e),s.update();break;default:o=n.NONE}}(e):function(e){if(!1===s.enabled)return;switch(o){case n.ROTATE:if(!1===s.enableRotate)return;!function(e){y.set(e.clientX,e.clientY),f.subVectors(y,w).multiplyScalar(s.rotateSpeed);const t=s.domElement;C(2*Math.PI*f.x/t.clientHeight),A(2*Math.PI*f.y/t.clientHeight),w.copy(y),s.update()}(e);break;case n.DOLLY:if(!1===s.enableZoom)return;!function(e){v.set(e.clientX,e.clientY),x.subVectors(v,M),x.y>0?D(T()):x.y<0&&R(T()),M.copy(v),s.update()}(e);break;case n.PAN:if(!1===s.enablePan)return;!function(e){b.set(e.clientX,e.clientY),E.subVectors(b,g).multiplyScalar(s.panSpeed),L(E.x,E.y),g.copy(b),s.update()}(e)}}(e))}function U(e){K(e),0===P.length&&(s.domElement.releasePointerCapture(e.pointerId),s.domElement.removeEventListener("pointermove",B),s.domElement.removeEventListener("pointerup",U)),s.dispatchEvent(p),o=n.NONE}function N(e){K(e)}function F(e){!1!==s.enabled&&!1!==s.enableZoom&&o===n.NONE&&(e.preventDefault(),s.dispatchEvent(d),Q(e),s.dispatchEvent(p))}function q(e){!1!==s.enabled&&!1!==s.enablePan&&function(e){let t=!1;switch(e.code){case s.keys.UP:L(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:L(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:L(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT:L(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}(e)}function W(e){!1!==s.enabled&&e.preventDefault()}function K(e){delete S[e.pointerId];for(let t=0;t<P.length;t++)if(P[t].pointerId==e.pointerId)return void P.splice(t,1)}function J(e){let i=S[e.pointerId];void 0===i&&(i=new t.Vector2,S[e.pointerId]=i),i.set(e.pageX,e.pageY)}function $(e){const t=e.pointerId===P[0].pointerId?P[1]:P[0];return S[t.pointerId]}s.domElement.addEventListener("contextmenu",W),s.domElement.addEventListener("pointerdown",G),s.domElement.addEventListener("pointercancel",N),s.domElement.addEventListener("wheel",F,{passive:!1}),this.update()}}const u=new t.Raycaster,w=new t.Vector3,y=new t.Vector3,f=new t.Quaternion,g={X:new t.Vector3(1,0,0),Y:new t.Vector3(0,1,0),Z:new t.Vector3(0,0,1)},b={type:"change"},E={type:"mouseDown"},M={type:"mouseUp",mode:null},v={type:"objectChange"};class x extends t.Object3D{constructor(e,i){super(),void 0===i&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const s=new G;this._gizmo=s,this.add(s);const n=new B;this._plane=n,this.add(n);const o=this;function r(e,t){let i=t;Object.defineProperty(o,e,{get:function(){return void 0!==i?i:t},set:function(t){i!==t&&(i=t,n[e]=t,s[e]=t,o.dispatchEvent({type:e+"-changed",value:t}),o.dispatchEvent(b))}}),o[e]=t,n[e]=t,s[e]=t}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const a=new t.Vector3,h=new t.Vector3,l=new t.Quaternion,c=new t.Quaternion,d=new t.Vector3,p=new t.Quaternion,m=new t.Vector3,u=new t.Vector3,w=new t.Vector3,y=new t.Vector3;r("worldPosition",a),r("worldPositionStart",h),r("worldQuaternion",l),r("worldQuaternionStart",c),r("cameraPosition",d),r("cameraQuaternion",p),r("pointStart",m),r("pointEnd",u),r("rotationAxis",w),r("rotationAngle",0),r("eye",y),this._offset=new t.Vector3,this._startNorm=new t.Vector3,this._endNorm=new t.Vector3,this._cameraScale=new t.Vector3,this._parentPosition=new t.Vector3,this._parentQuaternion=new t.Quaternion,this._parentQuaternionInv=new t.Quaternion,this._parentScale=new t.Vector3,this._worldScaleStart=new t.Vector3,this._worldQuaternionInv=new t.Quaternion,this._worldScale=new t.Vector3,this._positionStart=new t.Vector3,this._quaternionStart=new t.Quaternion,this._scaleStart=new t.Vector3,this._getPointer=P.bind(this),this._onPointerDown=_.bind(this),this._onPointerHover=S.bind(this),this._onPointerMove=T.bind(this),this._onPointerUp=C.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;u.setFromCamera(e,this.camera);const t=A(this._gizmo.picker[this.mode],u);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){u.setFromCamera(e,this.camera);const t=A(this._plane,u,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,E.mode=this.mode,this.dispatchEvent(E)}}pointerMove(e){const t=this.axis,i=this.mode,s=this.object;let n=this.space;if("scale"===i?n="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(n="world"),void 0===s||null===t||!1===this.dragging||-1!==e.button)return;u.setFromCamera(e,this.camera);const o=A(this._plane,u,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),"translate"===i)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===n&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===n&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===n&&(s.position.applyQuaternion(f.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),"world"===n&&(s.parent&&s.position.add(w.setFromMatrixPosition(s.parent.matrixWorld)),-1!==t.search("X")&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(w.setFromMatrixPosition(s.parent.matrixWorld))));else if("scale"===i){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),y.set(e,e,e)}else w.copy(this.pointStart),y.copy(this.pointEnd),w.applyQuaternion(this._worldQuaternionInv),y.applyQuaternion(this._worldQuaternionInv),y.divide(w),-1===t.search("X")&&(y.x=1),-1===t.search("Y")&&(y.y=1),-1===t.search("Z")&&(y.z=1);s.scale.copy(this._scaleStart).multiply(y),this.scaleSnap&&(-1!==t.search("X")&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===i){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(w.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(w.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(g[t]),w.copy(g[t]),"local"===n&&w.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(w.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===n&&"E"!==t&&"XYZE"!==t?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(f.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(f.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(b),this.dispatchEvent(v)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&(M.mode=this.mode,this.dispatchEvent(M)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(b),this.dispatchEvent(v),this.pointStart.copy(this.pointEnd))}getRaycaster(){return u}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function P(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function S(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function _(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function T(e){this.enabled&&this.pointerMove(this._getPointer(e))}function C(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function A(e,t,i){const s=t.intersectObject(e,!0);for(let e=0;e<s.length;e++)if(s[e].object.visible||i)return s[e];return!1}const O=new t.Euler,I=new t.Vector3(0,1,0),L=new t.Vector3(0,0,0),D=new t.Matrix4,R=new t.Quaternion,j=new t.Quaternion,Y=new t.Vector3,Q=new t.Matrix4,X=new t.Vector3(1,0,0),k=new t.Vector3(0,1,0),z=new t.Vector3(0,0,1),V=new t.Vector3,Z=new t.Vector3,H=new t.Vector3;class G extends t.Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new t.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new t.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const n=i.clone();n.opacity=.5;const o=e.clone();o.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const a=e.clone();a.color.setHex(255);const h=e.clone();h.color.setHex(16711680),h.opacity=.5;const l=e.clone();l.color.setHex(65280),l.opacity=.5;const c=e.clone();c.color.setHex(255),c.opacity=.5;const d=e.clone();d.opacity=.25;const p=e.clone();p.color.setHex(16776960),p.opacity=.25;e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const u=new t.CylinderGeometry(0,.04,.1,12);u.translate(0,.05,0);const w=new t.BoxGeometry(.08,.08,.08);w.translate(0,.04,0);const y=new t.BufferGeometry;y.setAttribute("position",new t.Float32BufferAttribute([0,0,0,1,0,0],3));const f=new t.CylinderGeometry(.0075,.0075,.5,3);function g(e,i){const s=new t.TorusGeometry(e,.0075,3,64,i*Math.PI*2);return s.rotateY(Math.PI/2),s.rotateX(Math.PI/2),s}f.translate(0,.25,0);const b={X:[[new t.Mesh(u,o),[.5,0,0],[0,0,-Math.PI/2]],[new t.Mesh(u,o),[-.5,0,0],[0,0,Math.PI/2]],[new t.Mesh(f,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new t.Mesh(u,r),[0,.5,0]],[new t.Mesh(u,r),[0,-.5,0],[Math.PI,0,0]],[new t.Mesh(f,r)]],Z:[[new t.Mesh(u,a),[0,0,.5],[Math.PI/2,0,0]],[new t.Mesh(u,a),[0,0,-.5],[-Math.PI/2,0,0]],[new t.Mesh(f,a),null,[Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.OctahedronGeometry(.1,0),d.clone()),[0,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},E={X:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,.3,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.OctahedronGeometry(.2,0),s)]],XY:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},M={START:[[new t.Mesh(new t.OctahedronGeometry(.01,2),n),null,null,null,"helper"]],END:[[new t.Mesh(new t.OctahedronGeometry(.01,2),n),null,null,null,"helper"]],DELTA:[[new t.Line(function(){const e=new t.BufferGeometry;return e.setAttribute("position",new t.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),n),null,null,null,"helper"]],X:[[new t.Line(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new t.Line(y,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new t.Line(y,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},v={XYZE:[[new t.Mesh(g(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new t.Mesh(g(.5,.5),o)]],Y:[[new t.Mesh(g(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new t.Mesh(g(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new t.Mesh(g(.75,1),p),null,[0,Math.PI/2,0]]]},x={AXIS:[[new t.Line(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={XYZE:[[new t.Mesh(new t.SphereGeometry(.25,10,8),s)]],X:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new t.Mesh(new t.TorusGeometry(.75,.1,2,24),s)]]},S={X:[[new t.Mesh(w,o),[.5,0,0],[0,0,-Math.PI/2]],[new t.Mesh(f,o),[0,0,0],[0,0,-Math.PI/2]],[new t.Mesh(w,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(w,r),[0,.5,0]],[new t.Mesh(f,r)],[new t.Mesh(w,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new t.Mesh(w,a),[0,0,.5],[Math.PI/2,0,0]],[new t.Mesh(f,a),[0,0,0],[Math.PI/2,0,0]],[new t.Mesh(w,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.BoxGeometry(.1,.1,.1),d.clone())]]},_={X:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,.3,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.2),s),[0,0,0]]]},T={X:[[new t.Line(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new t.Line(y,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new t.Line(y,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function C(e){const i=new t.Object3D;for(const t in e)for(let s=e[t].length;s--;){const n=e[t][s][0].clone(),o=e[t][s][1],r=e[t][s][2],a=e[t][s][3],h=e[t][s][4];n.name=t,n.tag=h,o&&n.position.set(o[0],o[1],o[2]),r&&n.rotation.set(r[0],r[1],r[2]),a&&n.scale.set(a[0],a[1],a[2]),n.updateMatrix();const l=n.geometry.clone();l.applyMatrix4(n.matrix),n.geometry=l,n.renderOrder=1/0,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),i.add(n)}return i}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=C(b)),this.add(this.gizmo.rotate=C(v)),this.add(this.gizmo.scale=C(S)),this.add(this.picker.translate=C(E)),this.add(this.picker.rotate=C(P)),this.add(this.picker.scale=C(_)),this.add(this.helper.translate=C(M)),this.add(this.helper.rotate=C(x)),this.add(this.helper.scale=C(T)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:j;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let e=0;e<i.length;e++){const s=i[e];let n;if(s.visible=!0,s.rotation.set(0,0,0),s.position.copy(this.worldPosition),n=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),s.scale.set(1,1,1).multiplyScalar(n*this.size/4),"helper"!==s.tag){if(s.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const e=.99,i=.2;"X"===s.name&&Math.abs(I.copy(X).applyQuaternion(t).dot(this.eye))>e&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),"Y"===s.name&&Math.abs(I.copy(k).applyQuaternion(t).dot(this.eye))>e&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),"Z"===s.name&&Math.abs(I.copy(z).applyQuaternion(t).dot(this.eye))>e&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),"XY"===s.name&&Math.abs(I.copy(z).applyQuaternion(t).dot(this.eye))<i&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),"YZ"===s.name&&Math.abs(I.copy(X).applyQuaternion(t).dot(this.eye))<i&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),"XZ"===s.name&&Math.abs(I.copy(k).applyQuaternion(t).dot(this.eye))<i&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1)}else"rotate"===this.mode&&(R.copy(t),I.copy(this.eye).applyQuaternion(f.copy(t).invert()),-1!==s.name.search("E")&&s.quaternion.setFromRotationMatrix(D.lookAt(this.eye,L,k)),"X"===s.name&&(f.setFromAxisAngle(X,Math.atan2(-I.y,I.z)),f.multiplyQuaternions(R,f),s.quaternion.copy(f)),"Y"===s.name&&(f.setFromAxisAngle(k,Math.atan2(I.x,I.z)),f.multiplyQuaternions(R,f),s.quaternion.copy(f)),"Z"===s.name&&(f.setFromAxisAngle(z,Math.atan2(I.y,I.x)),f.multiplyQuaternions(R,f),s.quaternion.copy(f)));s.visible=s.visible&&(-1===s.name.indexOf("X")||this.showX),s.visible=s.visible&&(-1===s.name.indexOf("Y")||this.showY),s.visible=s.visible&&(-1===s.name.indexOf("Z")||this.showZ),s.visible=s.visible&&(-1===s.name.indexOf("E")||this.showX&&this.showY&&this.showZ),s.material._color=s.material._color||s.material.color.clone(),s.material._opacity=s.material._opacity||s.material.opacity,s.material.color.copy(s.material._color),s.material.opacity=s.material._opacity,this.enabled&&this.axis&&(s.name===this.axis||this.axis.split("").some((function(e){return s.name===e})))&&(s.material.color.setHex(16776960),s.material.opacity=1)}else s.visible=!1,"AXIS"===s.name?(s.visible=!!this.axis,"X"===this.axis&&(f.setFromEuler(O.set(0,0,0)),s.quaternion.copy(t).multiply(f),Math.abs(I.copy(X).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),"Y"===this.axis&&(f.setFromEuler(O.set(0,0,Math.PI/2)),s.quaternion.copy(t).multiply(f),Math.abs(I.copy(k).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),"Z"===this.axis&&(f.setFromEuler(O.set(0,Math.PI/2,0)),s.quaternion.copy(t).multiply(f),Math.abs(I.copy(z).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),"XYZE"===this.axis&&(f.setFromEuler(O.set(0,Math.PI/2,0)),I.copy(this.rotationAxis),s.quaternion.setFromRotationMatrix(D.lookAt(L,I,k)),s.quaternion.multiply(f),s.visible=this.dragging),"E"===this.axis&&(s.visible=!1)):"START"===s.name?(s.position.copy(this.worldPositionStart),s.visible=this.dragging):"END"===s.name?(s.position.copy(this.worldPosition),s.visible=this.dragging):"DELTA"===s.name?(s.position.copy(this.worldPositionStart),s.quaternion.copy(this.worldQuaternionStart),w.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),w.applyQuaternion(this.worldQuaternionStart.clone().invert()),s.scale.copy(w),s.visible=this.dragging):(s.quaternion.copy(t),this.dragging?s.position.copy(this.worldPositionStart):s.position.copy(this.worldPosition),this.axis&&(s.visible=-1!==this.axis.search(s.name)))}super.updateMatrixWorld(e)}}class B extends t.Mesh{constructor(){super(new t.PlaneGeometry(1e5,1e5,2,2),new t.MeshBasicMaterial({visible:!1,wireframe:!0,side:t.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),V.copy(X).applyQuaternion("local"===t?this.worldQuaternion:j),Z.copy(k).applyQuaternion("local"===t?this.worldQuaternion:j),H.copy(z).applyQuaternion("local"===t?this.worldQuaternion:j),I.copy(Z),this.mode){case"translate":case"scale":switch(this.axis){case"X":I.copy(this.eye).cross(V),Y.copy(V).cross(I);break;case"Y":I.copy(this.eye).cross(Z),Y.copy(Z).cross(I);break;case"Z":I.copy(this.eye).cross(H),Y.copy(H).cross(I);break;case"XY":Y.copy(H);break;case"YZ":Y.copy(V);break;case"XZ":I.copy(H),Y.copy(Z);break;case"XYZ":case"E":Y.set(0,0,0)}break;default:Y.set(0,0,0)}0===Y.length()?this.quaternion.copy(this.cameraQuaternion):(Q.lookAt(w.set(0,0,0),Y,I),this.quaternion.setFromRotationMatrix(Q)),super.updateMatrixWorld(e)}}var U=function(){var e=0,t=document.createElement("div");function i(e){return t.appendChild(e.dom),e}function s(i){for(var s=0;s<t.children.length;s++)t.children[s].style.display=s===i?"block":"none";e=i}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(i){i.preventDefault(),s(++e%t.children.length)}),!1);var n=(performance||Date).now(),o=n,r=0,a=i(new U.Panel("FPS","#0ff","#002")),h=i(new U.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=i(new U.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:t,addPanel:i,showPanel:s,begin:function(){n=(performance||Date).now()},end:function(){r++;var e=(performance||Date).now();if(h.update(e-n,200),e>o+1e3&&(a.update(1e3*r/(e-o),100),o=e,r=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){n=this.end()},domElement:t,setMode:s}};U.Panel=function(e,t,i){var s=1/0,n=0,o=Math.round,r=o(window.devicePixelRatio||1),a=80*r,h=48*r,l=3*r,c=2*r,d=3*r,p=15*r,m=74*r,u=30*r,w=document.createElement("canvas");w.width=a,w.height=h,w.style.cssText="width:80px;height:48px";var y=w.getContext("2d");return y.font="bold "+9*r+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=i,y.fillRect(0,0,a,h),y.fillStyle=t,y.fillText(e,l,c),y.fillRect(d,p,m,u),y.fillStyle=i,y.globalAlpha=.9,y.fillRect(d,p,m,u),{dom:w,update:function(h,f){s=Math.min(s,h),n=Math.max(n,h),y.fillStyle=i,y.globalAlpha=1,y.fillRect(0,0,a,p),y.fillStyle=t,y.fillText(o(h)+" "+e+" ("+o(s)+"-"+o(n)+")",l,c),y.drawImage(w,d+r,p,m-r,u,d,p,m-r,u),y.fillRect(d+m-r,p,r,u),y.fillStyle=i,y.globalAlpha=.9,y.fillRect(d+m-r,p,r,o((1-h/f)*u))}}};class N extends U.Panel{constructor(e,t="GPU MS"){super(t,"#f90","#210");let i=!0,s=e.getExtension("EXT_disjoint_timer_query_webgl2");null===s&&(i=!1,s=e.getExtension("EXT_disjoint_timer_query"),null===s&&console.warn("GPUStatsPanel: disjoint_time_query extension not available.")),this.context=e,this.extension=s,this.maxTime=30,this.activeQueries=0,this.startQuery=function(){const e=this.context,t=this.extension;if(null===t)return;let s;i?(s=e.createQuery(),e.beginQuery(t.TIME_ELAPSED_EXT,s)):(s=t.createQueryEXT(),t.beginQueryEXT(t.TIME_ELAPSED_EXT,s)),this.activeQueries++;const n=()=>{let o,r,a;i?(o=e.getQueryParameter(s,e.QUERY_RESULT_AVAILABLE),r=e.getParameter(t.GPU_DISJOINT_EXT),a=e.getQueryParameter(s,e.QUERY_RESULT)):(o=t.getQueryObjectEXT(s,t.QUERY_RESULT_AVAILABLE_EXT),r=e.getParameter(t.GPU_DISJOINT_EXT),a=t.getQueryObjectEXT(s,t.QUERY_RESULT_EXT));const h=1e-6*a;o?(r||this.update(h,this.maxTime),this.activeQueries--):!1===e.isContextLost()&&requestAnimationFrame(n)};requestAnimationFrame(n)},this.endQuery=function(){const e=this.extension,t=this.context;null!==e&&(i?t.endQuery(e.TIME_ELAPSED_EXT):e.endQueryEXT(e.TIME_ELAPSED_EXT))}}}class F{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const q=new t.OrthographicCamera(-1,1,1,-1,0,1),W=new t.BufferGeometry;W.setAttribute("position",new t.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),W.setAttribute("uv",new t.Float32BufferAttribute([0,2,0,0,2,0],2));class K{constructor(e){this._mesh=new t.Mesh(W,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,q)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class J extends F{constructor(e,i,s,n,o){super(),this.scene=e,this.camera=i,this.overrideMaterial=s,this.clearColor=n,this.clearAlpha=void 0!==o?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new t.Color}render(e,t,i){const s=e.autoClear;let n,o;e.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),n=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,n),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),e.autoClear=s}}const $={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class ee extends F{constructor(e,i){super(),this.textureID=void 0!==i?i:"tDiffuse",e instanceof t.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=t.UniformsUtils.clone(e.uniforms),this.material=new t.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new K(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class te extends F{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const s=e.getContext(),n=e.state;let o,r;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0),this.inverse?(o=0,r=1):(o=1,r=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),n.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),n.buffers.stencil.setClear(r),n.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(s.EQUAL,1,4294967295),n.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),n.buffers.stencil.setLocked(!0)}}class ie extends F{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class se{constructor(e,i){if(this.renderer=e,void 0===i){const s=e.getSize(new t.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=s.width,this._height=s.height,(i=new t.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new ee($),this.clock=new t.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let t=0,s=this.passes.length;t<s;t++){const s=this.passes[t];if(!1!==s.enabled){if(s.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),s.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),s.needsSwap){if(i){const t=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),i.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==te&&(s instanceof te?i=!0:s instanceof ie&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const i=this.renderer.getSize(new t.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(i,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}const ne="default",oe="move",re="zoom-in",ae="alias",he={"3D":new t.Vector3(1e3,1e3,1e3),XY:new t.Vector3(0,0,1e3),XZ:new t.Vector3(0,1e3,0),YZ:new t.Vector3(1e3,0,0)},le=15;let ce=null,de=null,pe=null;class me{constructor(e,t,i){this.id=e,this.parentId=t,this.ancestorId=i}}class ue{constructor(){this.scene=new t.Scene,this.textures=new Map,this.materials=new Map,this.geometries=new Map,this._exclusion=[],this.pool=[]}set exclusion(e){this._exclusion=e,this.textures.clear(),this.materials.clear(),this.geometries.clear(),this.pool.length=0,this.scene.children.forEach((e=>this.track(e,!0)))}track(e){this.scene.add(e),this._exclusion.includes(e.type)||this.pool.push(e)}collect(e){pe=e.id;if(0!==e.children.length?e.children.forEach((e=>{this.collect(e),de=e.id})):de=e?.parent?.id,void 0!==e.geometry&&this.geometries.set(new me(pe,de,ce),e.geometry),void 0!==e.material){const t=e.material;Array.isArray(t)?t.forEach((e=>{this.materials.set(new me(pe,de,ce),e),this.collectTexture(e)})):(this.materials.set(new me(pe,de,ce),t),this.collectTexture(t))}}collectTexture(e){const t=t=>this.materials.set(new me(e.id,de,ce),t);e.alphaMap&&t(e.alphaMap),e.aoMap&&t(e.aoMap),e.envMap&&t(e.envMap),e.lightMap&&t(e.lightMap),e.map&&t(e.map),e.specularMap&&t(e.specularMap)}release(e){this.scene.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach((e=>e.dispose())):e.material.dispose())}}const we=new t.Raycaster,ye=[];return e.CAD=class{constructor(e,i,s){this.height=s||window.innerHeight,this.width=i||window.innerWidth,this._container=e,e.style.position="absolute",this.collector=new ue,this.renderer=new t.WebGLRenderer({antialias:!0}),this.renderer.setClearColor("#ffffff"),this.renderer.setSize(this.width,this.height),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.autoClear=!1;const n=le*(this.height/this.width);this.cameras={"3D":new t.OrthographicCamera(-le,le,n,-n,1,1e5),"2D":new t.OrthographicCamera(-le,le,n,-n,1,1e5)},this.mainCamera=this.cameras["3D"],this.cameras["3D"].up.set(0,0,1),this.cameras["3D"].position.copy(he["3D"]),this.cameras["3D"].name="3D",this.deputyCamera=this.cameras["2D"],this.cameras["2D"].up.set(0,0,1),this.cameras["2D"].position.copy(he.XY),this.cameras["2D"].name="2D",this.orbitControls=new m(this.mainCamera,this.renderer.domElement),this.trasnlater=new x(this.mainCamera,this.renderer.domElement),this.viewHelper=new l(this.mainCamera,this.renderer.domElement),this.viewHelper.position.set(.5,.5,0),this.stats=new U,this.stats.dom.style.position="absolute",this.gpuPanel=new N(this.renderer.getContext()),this.stats.addPanel(this.gpuPanel),this.stats.showPanel(0),this.userData={},this.mainView="3D",e.appendChild(this.stats.dom),e.appendChild(this.renderer.domElement),this.composer=new se(this.renderer),this.renderPass=new J(this.collector.scene,this.mainCamera),this.composer.addPass(this.renderPass),this.mode="SELECT",this.setMode(this.mode),this.listenerControl(),this.selectChange=()=>{}}add(e){this.collector.track(e)}remove(e){this.collector.release(e)}removeById(e){this.remove(this.collector.scene.getObjectById(e))}setView(e){this.mainView=e,"3D"===e?(this.mainCamera=this.cameras["3D"],this.deputyCamera=this.cameras["2D"]):(this.mainCamera=this.cameras["2D"],this.mainCamera.position.copy(he[e]),this.deputyCamera=this.cameras["3D"],this.mainCamera.updateProjectionMatrix()),this.renderPass.camera=this.viewHelper.editorCamera=this.orbitControls.object=this.mainCamera}setMode(e){this.mode=e,"SELECT"===e?(this.orbitControls.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this._container.style.cursor=ne):"ZOOM"===e?(this.orbitControls.mouseButtons={LEFT:t.MOUSE.DOLLY,MIDDLE:t.MOUSE.PAN,RIGHT:t.MOUSE.ROTATE},this._container.style.cursor=re):"PAN"===e?(this.orbitControls.mouseButtons={LEFT:t.MOUSE.PAN,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.ROTATE},this._container.style.cursor=oe):"ROTATE"===e&&(this.orbitControls.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.PAN,RIGHT:-1},this._container.style.cursor=ae)}render(){requestAnimationFrame((()=>this.render())),this.gpuPanel.startQuery(),this.renderer.clear(),this.composer.render(),this.orbitControls.update(),this.viewHelper.render(this.renderer),this.stats.update(),this.gpuPanel.endQuery()}resize(e,t){this.width=e,this.height=t,this.renderer.setSize(this.width,this.height);const i=le*t/e;Object.values(this.cameras).forEach((e=>{e.top=i,e.bottom=-i,e.updateProjectionMatrix()}))}listenerControl(){const e=new t.Vector2;this.renderer.domElement.addEventListener("click",(t=>{e.x=t.clientX/this.width*2-1,e.y=-t.clientY/this.height*2+1,we.setFromCamera(e,this.mainCamera),ye.length=[],we.intersectObjects(this.collector.pool,!0,ye),this.selectChange(ye)}))}},e.Collector=ue,e.Container=n,e.Control=class{constructor(e){this.orbitControls=new m(e.camera,e.target),this.tranformControls=new x(e.camera,e.target),this.orbitControls.addEventListener("change",(()=>{e.render()}))}},e.CoordinateHelper=r,e.CustomGridHelper=a,e.Editor=class{constructor(e){this.state={},this.target=e,this.container=new n,this.scene=new t.Scene,this.camera=o.clone(),this.renderer=new t.WebGLRenderer({antialias:!0}),this.renderer.autoClear=!1,this.viewHelper=new l(this.camera,e),e.append(this.renderer.domElement)}render(){this.renderer.clear(),this.viewHelper.render(this.renderer),this.renderer.render(this.scene,this.camera)}addObject(e){this.container.register(e),this.scene.add(e)}removeObject(e){this.container.discard(e),this.scene.remove(e)}getObjectById(e){this.container.findById(e)}setSize(e,t){this.renderer.setSize(e,t)}},e.ViewHelper=l,e}({},THREE);
